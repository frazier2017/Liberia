{
    "collab_server" : "",
    "contents" : "rm(list=ls())\n\nsetwd(\"/Users/tylerfrazier/Tresors/teaching/INTR100_Fall16/labs/lab_7_final\")\n\nlibrary(rgdal)\nlibrary(dplyr)\nlibrary(rgeos)\nlibrary(ggmap)\nlibrary(raster)\nlibrary(spatstat)\nlibrary(maptools)\nlibrary(sp)\nlibrary(foreign)\nlibrary(knitr)\n\n#CREATE SPATIAL POLYGON DATAFRAMES, CORRECT DATA AND FORTIFY\n#counties <- getData(\"GADM\", country=\"LBR\", level=1)\n\nafrica <- readOGR(dsn=\"shapefiles\", layer=\"africa\", stringsAsFactors=FALSE, verbose=FALSE)\ncountry <- readOGR(dsn=\"shapefiles\", layer=\"liberia_revised\", stringsAsFactors=FALSE, verbose=FALSE)\ncounties <- readOGR(dsn=\"shapefiles\", layer=\"counties\", stringsAsFactors=FALSE, verbose=FALSE)\ndistricts <- readOGR(dsn=\"shapefiles\", layer=\"districts\", stringsAsFactors=FALSE, verbose=FALSE)\nclans <- readOGR(dsn=\"shapefiles\", layer=\"clans\", stringsAsFactors=FALSE, verbose=FALSE)\n\nproj4string(counties)\n\ncountry <- spTransform(country, CRS(\"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0\"))\ncounties <- spTransform(counties, CRS(\"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0\"))\ndistricts <- spTransform(districts, CRS(\"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0\"))\nclans <- spTransform(clans, CRS(\"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0\"))\n\n#modify africa data frame\nafrica <- subset(africa, Land_Type == \"Primary land\")\nafrica <- subset(africa, COUNTRY == \"Sierra Leone\" | COUNTRY == \"Guinea\" | COUNTRY == \"CÃ´te d'Ivoire\")\n\n#correct Number of Households in Bomi County\nbomi <- subset(districts@data, FIRST_CCNA == \"Bomi\")\ncounties@data[1,7] <- sum(bomi$HHOLDS)\n\nafrica_f <- fortify(africa)\ncountry_f <- fortify(country)\ncounties_f <- fortify(counties)\ndistricts_f <- fortify(districts)\nclans_f <- fortify(clans)\n\n#COUNTRIES\n#create labels & join data to data frame\ncountry_names <- africa@data$COUNTRY\ncountry_cpts <- gCentroid(africa, byid=TRUE)\ncountry_labs <- cbind.data.frame(country_names, country_cpts@coords[,1], country_cpts@coords[,2])\nnames(country_labs) <- c(\"country\",\"x\",\"y\")\ncountry_labs[1,2] <- -7.75 #modify Cote d'Ivore location\ncountry_labs[1,3] <- 6.75 \ncountry_labs[2,2] <- -9.00 #modify Guinea location\ncountry_labs[2,3] <- 8.4 \ncountry_labs[3,2] <- -11.15 #modify Guinea location\ncountry_labs[3,3] <- 8.00 \n\n#COUNTIES\n#create labels & join data to data frame\ncounty_names <- counties@data$CCNAME\ncounty_cpts <- gCentroid(counties, byid=TRUE)\ncounty_labs <- cbind.data.frame(county_names, county_cpts@coords[,1], county_cpts@coords[,2])\nnames(county_labs) <- c(\"county\",\"x\",\"y\")\ncounty_labs[9,3] <- 6.65 # Margibi county location\ncounty_labs[9,2] <- -10.25\n\ncounties_d <- counties@data[,c(2,4:7)]\ncounties_d$id <- row.names(counties)\ncounties_f <- left_join(x = counties_f, y = counties_d, by = c(\"id\" = \"id\"))\n\n#DISTRICTS\n#create labels & join data to data frame\ndistrict_names <- districts@data$DNAME\ndistrict_cpts <- gCentroid(districts, byid=TRUE)\ndistrict_labs <- cbind.data.frame(district_names, district_cpts@coords[,1], district_cpts@coords[,2])\nnames(district_labs) <- c(\"district\",\"x\",\"y\")\n\ndistricts_d <- districts@data[,c(1,7:10)]\ndistricts_d$id <- row.names(districts)\ndistricts_f <- left_join(x = districts_f, y = districts_d, by = c(\"id\" = \"id\"))\n\n#CLANS\n#create labels & join data to data frame\nclan_names <- clans@data$CLNAME\nclan_cpts <- gCentroid(clans, byid=TRUE)\nclan_labs <- cbind.data.frame(clan_names, clan_cpts@coords[,1], clan_cpts@coords[,2])\nnames(clan_labs) <- c(\"clan\",\"x\",\"y\")\n\nclans_d <- clans@data[,c(1,5:8)]\nclans_d$id <- row.names(clans)\nclans_f <- left_join(x = clans_f, y = clans_d, by = c(\"id\" = \"id\"))\n\n# PLOT TOTAL POPULATION, MALE, FEMALE AND HOUSEHOLDS\n#Base map\nliberia <- get_map(location = c(-11.65, 4.25, -7.25, 8.6), maptype = \"watercolor\")\nliberia <- ggmap(liberia)\n\n# Population\n# Counties\nlbr_counties <- liberia + geom_map(data=counties_f,map=counties_f,aes(x=long, y=lat, map_id=id,fill =log10(SUM_TOTAL)))\nlbr_counties <- lbr_counties + geom_map(data=counties_f,map=counties_f,aes(x=long, y=lat, map_id=id), color =\"white\", alpha = 0, size = .5)\nlbr_counties <- lbr_counties + geom_map(data=africa_f,map=africa_f,aes(x=long, y=lat, map_id=id), color =\"white\", alpha = 0, size = 1.5)\nlbr_counties <- lbr_counties + scale_fill_gradient(low=\"yellow\", high=\"red\", space=\"Lab\")\nlbr_counties <- lbr_counties + annotate('text', x = county_labs$x, y = county_labs$y, label = county_labs$county, size = 4)\nlbr_counties <- lbr_counties + annotate('text', x = country_labs$x, y = country_labs$y, label = country_labs$country, size = 8)\nlbr_counties <- lbr_counties + ggtitle(\"Counties\")\nggsave(\"latex/lbr_counties.pdf\", lbr_counties, width = 10, height = 10, dpi = 300)\n\n# Districts\nlbr_districts <- liberia + geom_map(data=districts_f,map=districts_f,aes(x=long, y=lat, map_id=id,fill =log10(TOTAL)))\nlbr_districts <- lbr_districts + geom_map(data=counties_f,map=counties_f,aes(x=long, y=lat, map_id=id), color =\"white\", alpha = 0, size = 1.5)\nlbr_districts <- lbr_districts + geom_map(data=africa_f,map=africa_f,aes(x=long, y=lat, map_id=id), color =\"white\", alpha = 0, size = 1.5)\nlbr_districts <- lbr_districts + scale_fill_gradient(low=\"yellow\", high=\"red\", space=\"Lab\")\nlbr_districts <- lbr_districts + annotate('text', x = county_labs$x, y = county_labs$y, label = county_labs$county, size = 4)\nlbr_districts <- lbr_districts + annotate('text', x = country_labs$x, y = country_labs$y, label = country_labs$country, size = 8)\nlbr_districts <- lbr_districts + ggtitle(\"Districts\")\nggsave(\"latex/lbr_districts.pdf\", lbr_districts, width = 10, height = 10, dpi = 300)\n\n# Clans\nlbr_clans <- liberia + geom_map(data=clans_f,map=clans_f,aes(x=long, y=lat, map_id=id,fill = log10(SUM_TOTAL)))\n#lbr_clans <- lbr_clans + geom_map(data=districts_f,map=districts_f,aes(x=long, y=lat, map_id=id), color =\"white\", alpha = 0, size = .15)\nlbr_clans <- lbr_clans + geom_map(data=counties_f,map=counties_f,aes(x=long, y=lat, map_id=id), color =\"white\", alpha = 0, size = 1.5)\nlbr_clans <- lbr_clans + geom_map(data=africa_f,map=africa_f,aes(x=long, y=lat, map_id=id), color =\"white\", alpha = 0, size = 1.5)\nlbr_clans <- lbr_clans + scale_fill_gradient(low=\"yellow\", high=\"red\", space=\"Lab\")\nlbr_clans <- lbr_clans + annotate('text', x = county_labs$x, y = county_labs$y, label = county_labs$county, size = 4)\nlbr_clans <- lbr_clans + annotate('text', x = country_labs$x, y = country_labs$y, label = country_labs$country, size = 8)\nlbr_clans <- lbr_clans + ggtitle(\"Clans\")\nggsave(\"latex/lbr_clans.pdf\", lbr_clans, width = 10, height = 10, dpi = 300)\n\n# Male\n# Counties\nlbr_counties <- liberia + geom_map(data=counties_f,map=counties_f,aes(x=long, y=lat, map_id=id,fill =log10(SUM_MALE)))\nlbr_counties <- lbr_counties + geom_map(data=counties_f,map=counties_f,aes(x=long, y=lat, map_id=id), color =\"white\", alpha = 0, size = .5)\nlbr_counties <- lbr_counties + geom_map(data=africa_f,map=africa_f,aes(x=long, y=lat, map_id=id), color =\"white\", alpha = 0, size = 1.5)\nlbr_counties <- lbr_counties + scale_fill_gradient(low=\"yellow\", high=\"red\", space=\"Lab\")\nlbr_counties <- lbr_counties + annotate('text', x = county_labs$x, y = county_labs$y, label = county_labs$county, size = 4)\nlbr_counties <- lbr_counties + annotate('text', x = country_labs$x, y = country_labs$y, label = country_labs$country, size = 8)\nlbr_counties <- lbr_counties + ggtitle(\"Counties\")\nggsave(\"latex/male_counties.pdf\", lbr_counties, width = 10, height = 10, dpi = 300)\n\n# Districts\nlbr_districts <- liberia + geom_map(data=districts_f,map=districts_f,aes(x=long, y=lat, map_id=id,fill =log10(MALE)))\nlbr_districts <- lbr_districts + geom_map(data=counties_f,map=counties_f,aes(x=long, y=lat, map_id=id), color =\"white\", alpha = 0, size = 1.5)\nlbr_districts <- lbr_districts + geom_map(data=africa_f,map=africa_f,aes(x=long, y=lat, map_id=id), color =\"white\", alpha = 0, size = 1.5)\nlbr_districts <- lbr_districts + scale_fill_gradient(low=\"yellow\", high=\"red\", space=\"Lab\")\nlbr_districts <- lbr_districts + annotate('text', x = county_labs$x, y = county_labs$y, label = county_labs$county, size = 4)\nlbr_districts <- lbr_districts + annotate('text', x = country_labs$x, y = country_labs$y, label = country_labs$country, size = 8)\nlbr_districts <- lbr_districts + ggtitle(\"Districts\")\nggsave(\"latex/male_districts.pdf\", lbr_districts, width = 10, height = 10, dpi = 300)\n\n# Clans\nlbr_clans <- liberia + geom_map(data=clans_f,map=clans_f,aes(x=long, y=lat, map_id=id,fill = log10(SUM_MALE)))\n#lbr_clans <- lbr_clans + geom_map(data=districts_f,map=districts_f,aes(x=long, y=lat, map_id=id), color =\"white\", alpha = 0, size = .15)\nlbr_clans <- lbr_clans + geom_map(data=counties_f,map=counties_f,aes(x=long, y=lat, map_id=id), color =\"white\", alpha = 0, size = 1.5)\nlbr_clans <- lbr_clans + geom_map(data=africa_f,map=africa_f,aes(x=long, y=lat, map_id=id), color =\"white\", alpha = 0, size = 1.5)\nlbr_clans <- lbr_clans + scale_fill_gradient(low=\"yellow\", high=\"red\", space=\"Lab\")\nlbr_clans <- lbr_clans + annotate('text', x = county_labs$x, y = county_labs$y, label = county_labs$county, size = 4)\nlbr_clans <- lbr_clans + annotate('text', x = country_labs$x, y = country_labs$y, label = country_labs$country, size = 8)\nlbr_clans <- lbr_clans + ggtitle(\"Clans\")\nggsave(\"latex/male_clans.pdf\", lbr_clans, width = 10, height = 10, dpi = 300)\n\n# Female\n# Counties\nlbr_counties <- liberia + geom_map(data=counties_f,map=counties_f,aes(x=long, y=lat, map_id=id,fill =log10(SUM_FEMALE)))\nlbr_counties <- lbr_counties + geom_map(data=counties_f,map=counties_f,aes(x=long, y=lat, map_id=id), color =\"white\", alpha = 0, size = .5)\nlbr_counties <- lbr_counties + geom_map(data=africa_f,map=africa_f,aes(x=long, y=lat, map_id=id), color =\"white\", alpha = 0, size = 1.5)\nlbr_counties <- lbr_counties + scale_fill_gradient(low=\"yellow\", high=\"red\", space=\"Lab\")\nlbr_counties <- lbr_counties + annotate('text', x = county_labs$x, y = county_labs$y, label = county_labs$county, size = 4)\nlbr_counties <- lbr_counties + annotate('text', x = country_labs$x, y = country_labs$y, label = country_labs$country, size = 8)\nlbr_counties <- lbr_counties + ggtitle(\"Counties\")\nggsave(\"latex/female_counties.pdf\", lbr_counties, width = 10, height = 10, dpi = 300)\n\n# Districts\nlbr_districts <- liberia + geom_map(data=districts_f,map=districts_f,aes(x=long, y=lat, map_id=id,fill =log10(FEMALE)))\nlbr_districts <- lbr_districts + geom_map(data=counties_f,map=counties_f,aes(x=long, y=lat, map_id=id), color =\"white\", alpha = 0, size = 1.5)\nlbr_districts <- lbr_districts + geom_map(data=africa_f,map=africa_f,aes(x=long, y=lat, map_id=id), color =\"white\", alpha = 0, size = 1.5)\nlbr_districts <- lbr_districts + scale_fill_gradient(low=\"yellow\", high=\"red\", space=\"Lab\")\nlbr_districts <- lbr_districts + annotate('text', x = county_labs$x, y = county_labs$y, label = county_labs$county, size = 4)\nlbr_districts <- lbr_districts + annotate('text', x = country_labs$x, y = country_labs$y, label = country_labs$country, size = 8)\nlbr_districts <- lbr_districts + ggtitle(\"Districts\")\nggsave(\"latex/female_districts.pdf\", lbr_districts, width = 10, height = 10, dpi = 300)\n\n# Clans\nlbr_clans <- liberia + geom_map(data=clans_f,map=clans_f,aes(x=long, y=lat, map_id=id,fill = log10(SUM_FEMALE)))\n#lbr_clans <- lbr_clans + geom_map(data=districts_f,map=districts_f,aes(x=long, y=lat, map_id=id), color =\"white\", alpha = 0, size = .15)\nlbr_clans <- lbr_clans + geom_map(data=counties_f,map=counties_f,aes(x=long, y=lat, map_id=id), color =\"white\", alpha = 0, size = 1.5)\nlbr_clans <- lbr_clans + geom_map(data=africa_f,map=africa_f,aes(x=long, y=lat, map_id=id), color =\"white\", alpha = 0, size = 1.5)\nlbr_clans <- lbr_clans + scale_fill_gradient(low=\"yellow\", high=\"red\", space=\"Lab\")\nlbr_clans <- lbr_clans + annotate('text', x = county_labs$x, y = county_labs$y, label = county_labs$county, size = 4)\nlbr_clans <- lbr_clans + annotate('text', x = country_labs$x, y = country_labs$y, label = country_labs$country, size = 8)\nlbr_clans <- lbr_clans + ggtitle(\"Clans\")\nggsave(\"latex/female_clans.pdf\", lbr_clans, width = 10, height = 10, dpi = 300)\n\n\n\n# DATA PREPARATION FOR LAB\n# Import CWIQ10 from SPSS and save as .RData\n\n# cwiq10 <- read.spss(\"LBR_CWIQ_FINAL.sav\", to.data.frame = TRUE, use.value.labels = FALSE) #add foreign::\n# which( colnames(cwiq10)==\"wta_hh\" ) #give which column number\n# import only select variables\n# cwiq10 <- read.spss(\"LBR_CWIQ_FINAL.sav\", to.data.frame = TRUE, use.value.labels = FALSE)[,c(1,7,8,9,10,11,12,15,18,19,24:26,33,35,253)]\n# cwiq10$hid_mungai <- as.character(cwiq10$hid_mungai)\n# save(cwiq10, file = \"cwiq10.RData\")\n# rm(cwiq10)\n\n# LOAD CWIQ10 DATA AND JOIN TO GOV SUBDIVISION CENTER POINTS\nload(\"cwiq10.RData\")\n\ncnty_survey_cpts <- cbind.data.frame(county_id = counties@data$FIRST_CCOD, county_labs, stringsAsFactors = FALSE)\ndist_survey_cpts <- cbind.data.frame(county_id = districts@data$FIRST_CCOD, district_id = districts@data$FIRST_DCOD, district_labs)\nclan_survey_cpts <- cbind.data.frame(county_id = clans@data$FIRST_CCOD, district_id = clans@data$FIRST_DCOD, clan_id = clans@data$FIRST_CLCO, clan_labs)\n\n# Counties\n# table(cnty_survey_cpts$county_id)\n# table(cwiq10$county)\ncwiq10$county <- substr(cwiq10$hid_mungai,1,2)\ncwiq10$county[cwiq10$county == \"01\"] <- \"30\"\ncounty_cwiq10 <- left_join(x = cnty_survey_cpts, y = cwiq10, by = c(\"county_id\" = \"county\"))\n\n# Districts\n# length(table(dist_survey_cpts$district_code))\n# length(table(cwiq10$district_code))\ncwiq10$district <- substr(cwiq10$hid_mungai,3,4)\ndist_survey_cpts$district_code  <- paste(dist_survey_cpts$county_id, dist_survey_cpts$district_id, sep = \"\")\ncwiq10$district_code <- paste(cwiq10$county, cwiq10$district, sep= \"\")\ndistrict_cwiq10 <- left_join(x = dist_survey_cpts, y = cwiq10, by = c(\"district_code\" = \"district_code\"))\n# anti_join(x = dist_survey_cpts, y = cwiq10, by = c(\"district_code\" = \"district_code\"))\n# anti_join(x = cwiq10, y = dist_survey_cpts, by = c(\"district_code\" = \"district_code\"))\n\n# Clans\ncwiq10$clan_town <- substr(cwiq10$hid_mungai,5,7)\nclan_survey_cpts$clan_code  <- paste(clan_survey_cpts$county_id, clan_survey_cpts$district_id, clan_survey_cpts$clan_id, sep = \"\")\ncwiq10$clan_town_code <- paste(cwiq10$county, cwiq10$district, cwiq10$clan_town, sep= \"\")\nclan_cwiq10 <- left_join(x = clan_survey_cpts, y = cwiq10, by = c(\"clan_code\" = \"clan_town_code\"))\n# anti_join(x = clan_survey_cpts, y = cwiq10, by = c(\"clan_code\" = \"clan_town_code\"))\n# anti_join(x = cwiq10, y = clan_survey_cpts, by = c(\"clan_town_code\" = \"clan_code\"))\n\n# Being Analyzing Point Pattern\n\n#Add National boundary for Liberia\n\noptions(scipen=999)\n\ncountry <- readOGR(dsn=\"shapefiles\", layer=\"liberia_revised\", stringsAsFactors=FALSE, verbose=FALSE)\nproj4string(country)\ncountry <- spTransform(country, CRS(\"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0\"))\n\nwin <- as(country,\"owin\")\n\ncnty_weights <- county_cwiq10$wta_hh\ndist_weights <- district_cwiq10$wta_hh\nclan_weights <- clan_cwiq10$wta_hh\n\n# Total Population\n\nlbr_cnty <- ppp(x = county_cwiq10$x, y = county_cwiq10$y, window = win, marks = cnty_weights)\nlbr_dist <- ppp(x = district_cwiq10$x, y = district_cwiq10$y, window = win, marks = dist_weights)\nlbr_clan <- ppp(x = clan_cwiq10$x, y = clan_cwiq10$y, window = win, marks = clan_weights)\n\n\npar(mar=c(0,0,1,0))\n\npng(\"latex/pop_county.png\")\nplot(density(lbr_cnty), main = \"County Weights\")\ndev.off()\n\npng(\"latex/pop_district.png\")\nplot(density(lbr_dist), main = \"District Weights\")\ndev.off()\n\npng(\"latex/pop_clan.png\")\nplot(density(lbr_clan), main = \"Clan Weights\")\ndev.off()\n\n\n# Population by Gender\n\ncnty_gender <- as.factor(county_cwiq10$n1)\ndist_gender <- as.factor(district_cwiq10$n1)\nclan_gender <- as.factor(clan_cwiq10$n1)\n\nlevels(cnty_gender) <- c(\"male\", \"female\")\nlevels(dist_gender) <- c(\"male\", \"female\")\nlevels(clan_gender) <- c(\"male\", \"female\")\n\nlbr_cnty_gender <- ppp(x = county_cwiq10$x, y = county_cwiq10$y, window = win, marks = cnty_gender)\nlbr_dist_gender <- ppp(x = district_cwiq10$x, y = district_cwiq10$y, window = win, marks = dist_gender)\nlbr_clan_gender <- ppp(x = clan_cwiq10$x, y = clan_cwiq10$y, window = win, marks = clan_gender)\n\npar(oma=c(0,0,0,0))\npar(mar=c(0,0,0,0))\n\npdf(\"latex/gender_county.pdf\", width = 10, height = 5)\nplot(density(split(lbr_cnty_gender, weights = cnty_weights)), main = NA)\ndev.off()\n\npdf(\"latex/gender_district.pdf\", width = 10, height = 5)\nplot(density(split(lbr_dist_gender, weights = dist_weights)), main = NA)\ndev.off()\n\npdf(\"latex/gender_clan.pdf\", width = 10, height = 5)\nplot(density(split(lbr_clan_gender, weights = clan_weights)), main = NA)\ndev.off()\n\n#Female Population\n\ncnty_gender_female <- subset(county_cwiq10, n1 == 2)\ndist_gender_female <- subset(district_cwiq10, n1 == 2)\nclan_gender_female <- subset(clan_cwiq10, n1 == 2)\n\ncnty_female_ppp <- ppp(x = cnty_gender_female$x, y = cnty_gender_female$y, window = win, marks = cnty_gender_female$wta_hh)\ndist_female_ppp <- ppp(x = dist_gender_female$x, y = dist_gender_female$y, window = win, marks = dist_gender_female$wta_hh)\nclan_female_ppp <- ppp(x = clan_gender_female$x, y = clan_gender_female$y, window = win, marks = clan_gender_female$wta_hh)\n\npdf(\"latex/female_county.pdf\")\nplot(density(cnty_female_ppp), main = \"County Weights\")\ndev.off()\n\npdf(\"latex/female_dist.pdf\")\nplot(density(dist_female_ppp), main = \"District Weights\")\ndev.off()\n\npdf(\"latex/female_clan.pdf\")\nplot(density(clan_female_ppp), main = \"Clan Weights\")\ndev.off()\n\n#Male Population\n\ncnty_gender_male <- subset(county_cwiq10, n1 == 1)\ndist_gender_male <- subset(district_cwiq10, n1 == 1)\nclan_gender_male <- subset(clan_cwiq10, n1 == 1)\n\ncnty_male_ppp <- ppp(x = cnty_gender_male$x, y = cnty_gender_male$y, window = win, marks = cnty_gender_male$wta_hh)\ndist_male_ppp <- ppp(x = dist_gender_male$x, y = dist_gender_male$y, window = win, marks = dist_gender_male$wta_hh)\nclan_male_ppp <- ppp(x = clan_gender_male$x, y = clan_gender_male$y, window = win, marks = clan_gender_male$wta_hh)\n\npdf(\"latex/male_county.pdf\")\nplot(density(cnty_male_ppp), main = \"County Weights\")\ndev.off()\n\npdf(\"latex/male_dist.pdf\")\nplot(density(dist_male_ppp), main = \"District Weights\")\ndev.off()\n\npdf(\"latex/male_clan.pdf\")\nplot(density(clan_male_ppp), main = \"Clan Weights\")\ndev.off()\n\n# Ethnicity in Montserrado County\n\n#Base map Montserrado\ncoastal_lbr <- get_map(location = c(-11.00, 6.10, -10.25, 6.85), maptype = \"watercolor\")\ncoastal_lbr <- ggmap(coastal_lbr)\n\ncoastal_lbr <- coastal_lbr + geom_map(data=clans_f,map=clans_f,aes(x=long, y=lat, map_id=id,fill = log10(SUM_TOTAL)))\ncoastal_lbr <- coastal_lbr + geom_map(data=counties_f,map=counties_f,aes(x=long, y=lat, map_id=id), color =\"white\", alpha = 0, size = 1.5)\ncoastal_lbr <- coastal_lbr + geom_map(data=africa_f,map=africa_f,aes(x=long, y=lat, map_id=id), color =\"white\", alpha = 0, size = 1.5)\ncoastal_lbr <- coastal_lbr + scale_fill_gradient(low=\"yellow\", high=\"red\", space=\"Lab\")\ncoastal_lbr <- coastal_lbr + annotate('text', x = county_labs$x, y = county_labs$y, label = county_labs$county, size = 4)\ncoastal_lbr <- coastal_lbr + annotate('text', x = country_labs$x, y = country_labs$y, label = country_labs$country, size = 8)\ncoastal_lbr <- coastal_lbr + ggtitle(\"Clans\")\nggsave(\"latex/clans_coastal_lbr.pdf\", coastal_lbr, width = 10, height = 10, dpi = 300)\n\npar(mar=c(0,0,1,1))\n\nclan_ethnic_bassa <- subset(clan_cwiq10, n11 == 1)\nclan_ethnic_kpelle <- subset(clan_cwiq10, n11 == 8)\nclan_ethnic_kissi <- subset(clan_cwiq10, n11 == 9)\nclan_ethnic_lorma <- subset(clan_cwiq10, n11 == 12)\n\nmontserrado <- subset(clans, FIRST_CCOD == 30 )\n\nm_win <- as(montserrado,\"owin\")\n\nclan_monts_bassa <- ppp(x = clan_ethnic_bassa$x, y = clan_ethnic_bassa$y, window = m_win, marks = clan_ethnic_bassa$wta_hh)\nclan_monts_kpelle <- ppp(x = clan_ethnic_kpelle$x, y = clan_ethnic_kpelle$y, window = m_win, marks = clan_ethnic_kpelle$wta_hh)\nclan_monts_kissi <- ppp(x = clan_ethnic_kissi$x, y = clan_ethnic_kissi$y, window = m_win, marks = clan_ethnic_kissi$wta_hh)\nclan_monts_lorma <- ppp(x = clan_ethnic_lorma$x, y = clan_ethnic_lorma$y, window = m_win, marks = clan_ethnic_lorma$wta_hh)\n\npdf(\"latex/clan_monts_bassa.pdf\")\nplot(density(clan_monts_bassa), main = \"Bassa\")\ndev.off()\n\npdf(\"latex/clan_monts_kpelle.pdf\")\nplot(density(clan_monts_kpelle), main = \"Kpelle\")\ndev.off()\n\npdf(\"latex/clan_monts_kissi.pdf\")\nplot(density(clan_monts_kissi), main = \"Kissi\")\ndev.off()\n\npdf(\"latex/clan_monts_lorma.pdf\")\nplot(density(clan_monts_lorma), main = \"Lorma\")\ndev.off()\n\n# Compare Religion and Education across Liberia\n\nclan_religion_christian <- subset(clan_cwiq10, n12 == 1)\nclan_religion_muslim <- subset(clan_cwiq10, n12 == 2)\nclan_edu_none <- subset(clan_cwiq10, o3 == 0)\nclan_edu_p6 <- subset(clan_cwiq10, o3 == 16)\nclan_edu_sh12 <- subset(clan_cwiq10, o3 == 26)\nclan_edu_uni <- subset(clan_cwiq10, o3 == 31)\n\n\nclan_cnty_christian <- ppp(x = clan_religion_christian$x, y = clan_religion_christian$y, window = win, marks = clan_religion_christian$wta_hh)\nclan_cnty_muslim <- ppp(x = clan_religion_muslim$x, y = clan_religion_muslim$y, window = win, marks = clan_religion_muslim$wta_hh)\nclan_cnty_none <- ppp(x = clan_edu_none$x, y = clan_edu_none$y, window = win, marks = clan_edu_none$wta_hh)\nclan_cnty_p6 <- ppp(x = clan_edu_p6$x, y = clan_edu_p6$y, window = win, marks = clan_edu_p6$wta_hh)\nclan_cnty_sh12 <- ppp(x = clan_edu_sh12$x, y = clan_edu_sh12$y, window = win, marks = clan_edu_sh12$wta_hh)\nclan_cnty_uni <- ppp(x = clan_edu_uni$x, y = clan_edu_uni$y, window = win, marks = clan_edu_uni$wta_hh)\n\npar(mar=c(0,0,1,1))\n\npdf(\"latex/clan_cnty_christian.pdf\")\nplot(density(clan_cnty_christian), main = \"Christian\")\ndev.off()\n\npdf(\"latex/clan_cnty_muslim.pdf\")\nplot(density(clan_cnty_muslim), main = \"Muslim\")\ndev.off()\n\npdf(\"latex/clan_cnty_none.pdf\")\nplot(density(clan_cnty_none), main = \"No Education\")\ndev.off()\n\npdf(\"latex/clan_cnty_p6.pdf\")\nplot(density(clan_cnty_p6), main = \"Grade School\")\ndev.off()\n\npdf(\"latex/clan_cnty_sh12.pdf\")\nplot(density(clan_cnty_sh12), main = \"High School\")\ndev.off()\n\npdf(\"latex/clan_cnty_uni.pdf\")\nplot(density(clan_cnty_uni), main = \"University\")\ndev.off()\n\n# Compare Religion and Education in Montserrado\n\nclan_mont_christian <- ppp(x = clan_religion_christian$x, y = clan_religion_christian$y, window = m_win, marks = clan_religion_christian$wta_hh)\nclan_mont_muslim <- ppp(x = clan_religion_muslim$x, y = clan_religion_muslim$y, window = m_win, marks = clan_religion_muslim$wta_hh)\nclan_mont_none <- ppp(x = clan_edu_none$x, y = clan_edu_none$y, window = m_win, marks = clan_edu_none$wta_hh)\nclan_mont_p6 <- ppp(x = clan_edu_p6$x, y = clan_edu_p6$y, window = m_win, marks = clan_edu_p6$wta_hh)\nclan_mont_sh12 <- ppp(x = clan_edu_sh12$x, y = clan_edu_sh12$y, window = m_win, marks = clan_edu_sh12$wta_hh)\nclan_mont_uni <- ppp(x = clan_edu_uni$x, y = clan_edu_uni$y, window = m_win, marks = clan_edu_uni$wta_hh)\n\npar(mar=c(0,0,1,1))\n\npdf(\"latex/clan_mont_christian.pdf\")\nplot(density(clan_mont_christian), main = \"Christian\")\ndev.off()\n\npdf(\"latex/clan_mont_muslim.pdf\")\nplot(density(clan_mont_muslim), main = \"Muslim\")\ndev.off()\n\npdf(\"latex/clan_mont_none.pdf\")\nplot(density(clan_mont_none), main = \"No Education\")\ndev.off()\n\npdf(\"latex/clan_mont_p6.pdf\")\nplot(density(clan_mont_p6), main = \"Grade School\")\ndev.off()\n\npdf(\"latex/clan_mont_sh12.pdf\")\nplot(density(clan_mont_sh12), main = \"High School\")\ndev.off()\n\npdf(\"latex/clan_mont_uni.pdf\")\nplot(density(clan_mont_uni), main = \"University\")\ndev.off()\n\n\n\n# Population by Age\n\ncnty_age <- cut(county_cwiq10$n4, 4)\ndist_age <- cut(district_cwiq10$n4, 4)\nclan_age <- cut(clan_cwiq10$n4, 4)\n\nlbr_cnty_age <- ppp(x = county_cwiq10$x, y = county_cwiq10$y, window = win, marks = cnty_age)\nlbr_dist_age <- ppp(x = district_cwiq10$x, y = district_cwiq10$y, window = win, marks = dist_age)\nlbr_clan_age <- ppp(x = clan_cwiq10$x, y = clan_cwiq10$y, window = win, marks = clan_age)\n\nplot(density(split(lbr_cnty_age, weights = cnty_weights)))\nplot(density(split(lbr_dist_age, weights = dist_weights)))\nplot(density(split(lbr_clan_age, weights = clan_weights)))\n\n# Ethnicity\n\ncnty_ethnic <- as.factor(county_cwiq10$n11)\ndist_ethnic <- as.factor(district_cwiq10$n11)\nclan_ethnic <- as.factor(clan_cwiq10$n11)\n\nlevels(cnty_ethnic) <- c(\"bassa\", \"belle\", \"dey\", \"gbandi\", \"gio\", \"gola\", \"grebo\", \"kpelle\", \"kissi\", \"krahn\", \"kru\", \"lorma\", \"mandingo\", \"mano\", \"mende\", \"sapo\", \"vai\", \"naturalized\", \"congo/american\")\nlevels(dist_ethnic) <- c(\"bassa\", \"belle\", \"dey\", \"gbandi\", \"gio\", \"gola\", \"grebo\", \"kpelle\", \"kissi\", \"krahn\", \"kru\", \"lorma\", \"mandingo\", \"mano\", \"mende\", \"sapo\", \"vai\", \"naturalized\", \"congo/american\")\nlevels(clan_ethnic) <- c(\"bassa\", \"belle\", \"dey\", \"gbandi\", \"gio\", \"gola\", \"grebo\", \"kpelle\", \"kissi\", \"krahn\", \"kru\", \"lorma\", \"mandingo\", \"mano\", \"mende\", \"sapo\", \"vai\", \"naturalized\", \"congo/american\")\n\nlbr_cnty_ethnic <- ppp(x = county_cwiq10$x, y = county_cwiq10$y, window = win, marks = cnty_ethnic)\nlbr_dist_ethnic <- ppp(x = district_cwiq10$x, y = district_cwiq10$y, window = win, marks = dist_ethnic)\nlbr_clan_ethnic <- ppp(x = clan_cwiq10$x, y = clan_cwiq10$y, window = win, marks = clan_ethnic)\n\nplot(density(split(lbr_cnty_ethnic, weights = cnty_weights)))\nplot(density(split(lbr_dist_ethnic, weights = dist_weights)))\nplot(density(split(lbr_clan_ethnic, weights = clan_weights)))\n\n# Religion\n\ncnty_religion <- as.factor(county_cwiq10$n12)\ndist_religion <- as.factor(district_cwiq10$n12)\nclan_religion <- as.factor(clan_cwiq10$n12)\n\nlevels(cnty_religion) <- c(\"christian\", \"muslim\", \"traditional\", \"other\", \"none\")\nlevels(dist_religion) <- c(\"christian\", \"muslim\", \"traditional\", \"other\", \"none\")\nlevels(clan_religion) <- c(\"christian\", \"muslim\", \"traditional\", \"other\", \"none\")\n  \nlbr_cnty_religion <- ppp(x = county_cwiq10$x, y = county_cwiq10$y, window = win, marks = cnty_religion)\nlbr_dist_religion <- ppp(x = district_cwiq10$x, y = district_cwiq10$y, window = win, marks = dist_religion)\nlbr_clan_religion <- ppp(x = clan_cwiq10$x, y = clan_cwiq10$y, window = win, marks = clan_religion)\n\nplot(density(split(lbr_cnty_religion, weights = cnty_weights)))\nplot(density(split(lbr_dist_religion, weights = dist_weights)))\nplot(density(split(lbr_clan_religion, weights = clan_weights)))\n\n# Education\n\ncnty_edu <- as.factor(county_cwiq10$o3)\ndist_edu <- as.factor(district_cwiq10$o3)\nclan_edu <- as.factor(clan_cwiq10$o3)\n\nlevels(cnty_edu) <- c(\"none\", \"pre-school\", \"p1\", \"p2\", \"p3\", \"p4\", \"p5\", \"p6\", \"s7\", \"s8\", \"s9\", \"sh10\", \"sh11\", \"sh12\", \"university\", \"vocational\", \"tech-training\", \"technical\")\nlevels(dist_edu) <- c(\"none\", \"pre-school\", \"p1\", \"p2\", \"p3\", \"p4\", \"p5\", \"p6\", \"s7\", \"s8\", \"s9\", \"sh10\", \"sh11\", \"sh12\", \"university\", \"vocational\", \"tech-training\", \"technical\")\nlevels(clan_edu) <- c(\"none\", \"pre-school\", \"p1\", \"p2\", \"p3\", \"p4\", \"p5\", \"p6\", \"s7\", \"s8\", \"s9\", \"sh10\", \"sh11\", \"sh12\", \"university\", \"vocational\", \"tech-training\", \"technical\")\n\nlbr_cnty_edu <- ppp(x = county_cwiq10$x, y = county_cwiq10$y, window = win, marks = cnty_edu)\nlbr_dist_edu <- ppp(x = district_cwiq10$x, y = district_cwiq10$y, window = win, marks = dist_edu)\nlbr_clan_edu <- ppp(x = clan_cwiq10$x, y = clan_cwiq10$y, window = win, marks = clan_edu)\n\nplot(density(split(lbr_cnty_edu, weights = cnty_weights)), main = \"Education - County Weights\")\nplot(density(split(lbr_dist_edu, weights = dist_weights)), main = \"Education - District Weights\")\nplot(density(split(lbr_clan_edu, weights = clan_weights)), main = \"Education - Clan Weights\")\n\n\n\n\n\n\n\n#contour(density(liberia_gender, weights = weights))\n     \nlbr_dist_gender <- ppp(x = district_cwiq10$x, y = district_cwiq10$y, window = win, marks = gender)\nplot(density(lbr_cnty_gender, weights = weights))\nplot(density(split(lbr_cnty_gender, weights = weights)))\n     \n     \n\n\n\n\n\n\n\n###### Setting Points ##### Not Needed ##############\n\n# convert 01 to 30\n\ncpts03 <- subset(cnty_survey_cpts,county_id == \"03\")\ncpts06 <- subset(cnty_survey_cpts,county_id == \"06\")\ncpts09 <- subset(cnty_survey_cpts,county_id == \"09\")\ncpts12 <- subset(cnty_survey_cpts,county_id == \"12\")\ncpts15 <- subset(cnty_survey_cpts,county_id == \"15\")\ncpts18 <- subset(cnty_survey_cpts,county_id == \"18\")\ncpts21 <- subset(cnty_survey_cpts,county_id == \"21\")\ncpts24 <- subset(cnty_survey_cpts,county_id == \"24\")\ncpts27 <- subset(cnty_survey_cpts,county_id == \"27\")\ncpts30 <- subset(cnty_survey_cpts,county_id == \"30\")\ncpts33 <- subset(cnty_survey_cpts,county_id == \"33\")\ncpts36 <- subset(cnty_survey_cpts,county_id == \"36\")\ncpts39 <- subset(cnty_survey_cpts,county_id == \"39\")\ncpts42 <- subset(cnty_survey_cpts,county_id == \"42\")\ncpts45 <- subset(cnty_survey_cpts,county_id == \"45\")\n\n# simplify\n\ncwiq10_cpts <- rbind.data.frame(\n  \n  cpts03[rep(1, each = nrow(subset(cwiq10, county == 3))),],\n  cpts06[rep(1, each = nrow(subset(cwiq10, county == 6))),],\n  cpts09[rep(1, each = nrow(subset(cwiq10, county == 9))),],\n  cpts12[rep(1, each = nrow(subset(cwiq10, county == 12))),],\n  cpts15[rep(1, each = nrow(subset(cwiq10, county == 15))),],\n  cpts18[rep(1, each = nrow(subset(cwiq10, county == 18))),],\n  cpts21[rep(1, each = nrow(subset(cwiq10, county == 21))),],\n  cpts24[rep(1, each = nrow(subset(cwiq10, county == 24))),],\n  cpts27[rep(1, each = nrow(subset(cwiq10, county == 27))),],\n  cpts30[rep(1, each = nrow(subset(cwiq10, county == 1 | county == 30))),],\n  cpts33[rep(1, each = nrow(subset(cwiq10, county == 33))),],\n  cpts36[rep(1, each = nrow(subset(cwiq10, county == 36))),],\n  cpts39[rep(1, each = nrow(subset(cwiq10, county == 39))),],\n  cpts42[rep(1, each = nrow(subset(cwiq10, county == 42))),],\n  cpts45[rep(1, each = nrow(subset(cwiq10, county == 45))),]\n  \n)\n\n\n\n###### Setting Points ##### Not Needed ##############\n\n\n\n\n\n#win <- as(counties,\"owin\")\n\nwin1 <- slot(counties, \"polygons\")[1]\nwin2 <- slot(counties, \"polygons\")[2]\nwin3 <- slot(counties, \"polygons\")[3]\nwin4 <- slot(counties, \"polygons\")[4]\nwin5 <- slot(counties, \"polygons\")[5]\nwin6 <- slot(counties, \"polygons\")[6]\nwin7 <- slot(counties, \"polygons\")[7]\nwin8 <- slot(counties, \"polygons\")[8]\nwin9 <- slot(counties, \"polygons\")[9]\nwin10 <- slot(counties, \"polygons\")[10]\nwin11 <- slot(counties, \"polygons\")[11]\nwin12 <- slot(counties, \"polygons\")[12]\nwin13 <- slot(counties, \"polygons\")[13]\nwin14 <- slot(counties, \"polygons\")[14]\nwin15 <- slot(counties, \"polygons\")[15]\n\n#win1 <- counties@polygons[1]\n\nwin1 <- SpatialPolygons(win1)\nwin2 <- SpatialPolygons(win2)\nwin3 <- SpatialPolygons(win3)\nwin4 <- SpatialPolygons(win4)\nwin5 <- SpatialPolygons(win5)\nwin6 <- SpatialPolygons(win6)\nwin7 <- SpatialPolygons(win7)\nwin8 <- SpatialPolygons(win8)\nwin9 <- SpatialPolygons(win9)\nwin10 <- SpatialPolygons(win10)\nwin11 <- SpatialPolygons(win11)\nwin12 <- SpatialPolygons(win12)\nwin13 <- SpatialPolygons(win13)\nwin14 <- SpatialPolygons(win14)\nwin15 <- SpatialPolygons(win15)\n\n#win2_3 <- lapply(c(win2,win3), function(x){SpatialPolygons(list(x))})\n\nwin1 <- as(win1,\"owin\")\nwin2 <- as(win2,\"owin\")\nwin3 <- as(win3,\"owin\")\nwin4 <- as(win4,\"owin\")\nwin5 <- as(win5,\"owin\")\nwin6 <- as(win6,\"owin\")\nwin7 <- as(win7,\"owin\")\nwin8 <- as(win8,\"owin\")\nwin9 <- as(win9,\"owin\")\nwin10 <- as(win10,\"owin\")\nwin11 <- as(win11,\"owin\")\nwin12 <- as(win12,\"owin\")\nwin13 <- as(win13,\"owin\")\nwin14 <- as(win14,\"owin\")\nwin15 <- as(win15,\"owin\")\n\n# win10 <- rpoint(5, win = win1)\n# win10 <- dirichlet(win10)\n# \n# win10a <- as.owin(win10[1])\n# win10b <- as.owin(win10[2])\n# win10c <- as.owin(win10[3])\n# win10d <- as.owin(win10[4])\n# win10e <- as.owin(win10[5])\n\n#win2_3 <- solapply(win2_3, as.owin)\n\n# wins <- solist(win1,win2,win3,win4,\n#                win5,win6,win7,win8,win9,\n#                win10a,win10b,win10c,win10d,win10e,\n#                win11,win12,win13,win14,win15)\n\n#w/o dirichelet polygons\n\nwins <- solist(win1,win2,win3,win4,\n               win5,win6,win7,win8,win9,\n               win10,win11,win12,win13,win14,\n               win15)\n\nte <- tess(tiles=wins)\n\nplot(te)\n\n\ngovs <- as(te, \"SpatialPolygons\")\n\nproj4string(govs) <- \"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0\"\n\n#govs <- spTransform(govs, CRS(\"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0\"))\n\nplot(govs)\n\ngovs <- fortify(govs)\n\nliberia <- get_map(location = c(-13, 3, -6, 9), maptype = \"watercolor\")\n\nliberia <- ggmap(liberia)\n\nliberia <- liberia + geom_map(data=govs,\n                              map=govs,\n                              aes(x=long, y=lat, map_id=id),\n                              color =\"white\",\n                              fill =\"orangered4\",\n                              alpha = .4,\n                              size = .2)\n\n\n\n\n\nwin1 <- as(counties[counties@data$OBJECTID == 1,],\"owin\")\nwin2 <- as(counties[counties@data$OBJECTID == 2,],\"owin\")\nwin3 <- as(counties[counties@data$OBJECTID == 3,],\"owin\")\nwin4 <- as(counties[counties@data$OBJECTID == 4,],\"owin\")\nwin5 <- as(counties[counties@data$OBJECTID == 5,],\"owin\")\n\nwin1 <- rpoint(10, win = win1)\n\nwin1 <- dirichlet(win1)\n\nwin1_2 <- solapply(c(win1,win2), as.owin)\n\n\n\nplot(win1)\n\n\n\n\n\nplot(counties)\npoints(spsample(counties[counties@data$OBJECTID == 2,], n = 10, \"random\"), pch = 1, cex = .75)\n\n",
    "created" : 1496683074834.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3101015916",
    "id" : "9114C236",
    "lastKnownWriteTime" : 1496683339,
    "last_content_update" : 1496683339,
    "path" : "~/GitHub/Liberia/tyler_code.R",
    "project_path" : "tyler_code.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}