{
    "collab_server" : "",
    "contents" : "rm(list=ls())\nsetwd(\"~/GitHub/Liberia\")\n\n#install.packages(\"mapdata\")\n#install.packages(\"rgl\",dependencies = T)\n#install.packages(\"XQuartz\")\n\nlibrary(rgdal)\nlibrary(dplyr)\nlibrary(rgeos)\nlibrary(ggmap)\nlibrary(raster)\nlibrary(spatstat)\nlibrary(maptools)\nlibrary(sp)\nlibrary(foreign)\nlibrary(knitr)\nlibrary(gridExtra)\nlibrary(rasterVis)\nlibrary(colorspace)\nlibrary(mapdata)\nlibrary(rgl)\nlibrary(scales)\nlibrary(plot3Drgl)\nlibrary(plotly)\n\n##\n\n#### DATA ####\n\n## Import Shapefiles ##\ncountry<-readOGR(dsn=\"shapefiles\", layer=\"liberia_revised\",stringsAsFactors=FALSE, verbose=FALSE)\ncnty<-readOGR(dsn = \"shapefiles\",layer=\"counties\",stringsAsFactors = FALSE,verbose=FALSE)\ndist<-readOGR(dsn=\"shapefiles\",layer=\"districts\", stringsAsFactors = FALSE,verbose = FALSE)\nclan<-readOGR(dsn=\"shapefiles\",layer=\"clans\", stringsAsFactors = FALSE,verbose = FALSE)\n\ncountry<-spTransform(country, CRS(\"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0\"))\ncnty<-spTransform(cnty, CRS(\"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0\"))\ndist<-spTransform(dist, CRS(\"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0\"))\nclan<-spTransform(clan, CRS(\"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0\"))\n\n### Fortify shapefiles ###\ncountry_f<-fortify(country)\ncnty_f<-fortify(cnty)\ndist_f<-fortify(dist)\nclan_f<-fortify(clan)\n\n## Import GPW4 data ##\ngpw4_2000<-raster(\"~/GoogleDrive/LiberiaProject/gpw-v4-population-count_2000.tif\")\ngpw4_2000<-crop(gpw4_2000,extent(country))\n#gpw4_2000<-mask(gpw4_2000,country)\n\ngpw4_2005<-raster(\"~/GoogleDrive/LiberiaProject/gpw-v4-population-count_2005.tif\")\ngpw4_2005<-crop(gpw4_2005,extent(country))\n#gpw4_2005<-mask(gpw4_2005,country)\n\ngpw4_2010<-raster(\"~/GoogleDrive/LiberiaProject/gpw-v4-population-count_2010.tif\")\ngpw4_2010<-crop(gpw4_2010,extent(country))\n#gpw4_2010<-mask(gpw4_2010,country)\n\ngpw4_2015<-raster(\"~/GoogleDrive/LiberiaProject/gpw-v4-population-count_2015.tif\")\ngpw4_2015<-crop(gpw4_2015,extent(country))\n#gpw4_2015<-mask(gpw4_2015,country)\n\n\n##\n\n\n#### V1. SHAPEFILES DATA ####\n  \n  ### CORRECT DATA ###\n  cnty@data$SUM_HH[1]<-20508\n  dist@data[which(dist@data$FIRST_CCNA==\"Bomi\"),]$HHOLDS<-dist@data[which(dist@data$FIRST_CCNA==\"Bomi\"),]$TOTAL/(cnty@data$SUM_TOTAL[1]/cnty@data$SUM_HH[1])\n  clan@data[which(clan@data$FIRST_CCNA==\"Bomi\"),]$SUM_HH<-clan@data[which(clan@data$FIRST_CCNA==\"Bomi\"),]$SUM_TOTAL/(cnty@data$SUM_TOTAL[1]/cnty@data$SUM_HH[1])\n  clan@data[which(clan@data$FIRST_CCNA==\"River Gee\"),]$SUM_HH[29]<-clan@data[which(clan@data$FIRST_CCNA==\"River Gee\"),]$SUM_TOTAL[29]/mean(clan@data[which(clan@data$FIRST_CCNA==\"River Gee\"),]$SUM_TOTAL[c(1:28,30:45)]/clan@data[which(clan@data$FIRST_CCNA==\"River Gee\"),]$SUM_HH[c(1:28,30:45)])\n  \n  \n  ### MERGE DATA ###\n  cnty@data$ID<-as.character(c(0:14))\n  cnty_shp_f<-left_join(x=cnty_f,y=cnty@data,by=c(\"id\"=\"ID\"))\n  dist@data$ID<-as.character(c(0:135))\n  dist_shp_f<-left_join(x=dist_f,y=dist@data,by=c(\"id\"=\"ID\"))\n  clan@data$ID<-as.character(c(0:815))\n  clan_shp_f<-left_join(x=clan_f,y=clan@data,by=c(\"id\"=\"ID\"))\n  \n  # ### ADJUST LABELS ###\n  # ct_points<-gCentroid(counties,byid=TRUE)\n  # county_labels<-cbind.data.frame(counties@data$CCNAME,ct_points@coords[,1],ct_points@coords[,2])\n  # colnames(county_labels)<-c(\"name\",\"x\",\"y\")\n  # county_labels[9,2]<--10.2\n  # county_labels[9,3]<-6.63\n  # ct_points_2<-gCentroid(districts,byid=TRUE)\n  # district_labels<-cbind.data.frame(districts@data$DNAME,ct_points_2@coords[,1],ct_points_2@coords[,2])\n  # colnames(district_labels)<-c(\"name\",\"x\",\"y\")\n  # ct_points_3<-gCentroid(clans,byid=TRUE)\n  # clan_labels<-cbind.data.frame(clans@data$CLNAME,clans@data$FIRST_DNAM,ct_points_3@coords[,1],ct_points_3@coords[,2])\n  # colnames(clan_labels)<-c(\"name\",\"district\",\"x\",\"y\")\n  # clan_labels2<-clan_labels\n  # n<-nrow(clan_labels[which(clan_labels$district==\"Greater Monrovia\"),])\n  # remove<-vector(\"list\",length=n)\n  # clan_labels[which(clan_labels$dist == \"Greater Monrovia\"),]$name <- remove\n  # m<-nrow(clan_labels[which(clan_labels$dist==\"Commonwealth\"),])\n  # remove2<-vector(\"list\",m)\n  # clan_labels[which(clan_labels$dist == \"Commonwealth\"),]$name <- remove2\n  \n  ### MAKE MAPS ###\n  map4<-ggplot()+\n    geom_map(data=cnty_shp_f,map=cnty_shp_f,aes(x=long,y=lat,map_id=id,fill=log(SUM_TOTAL)))+\n    scale_fill_gradientn(colours = c(\"grey100\",\"red2\"),guide=guide_colourbar(title=NULL),space=\"Lab\",na.value = \"grey60\")+\n    geom_map(data=cnty_shp_f,map=cnty_shp_f,aes(x=long,y=lat,map_id=id),color=\"grey45\",alpha=0,size=.2)+\n    theme(text = element_text(color = \"white\"),\n          rect = element_rect(fill = \"grey35\", color = \"grey35\"),\n          plot.background = element_rect(fill = \"grey35\", color = \"grey35\"),\n          panel.background = element_rect(fill = \"grey35\", color = \"grey35\"),\n          plot.title = element_text(),\n          panel.grid = element_blank(),\n          panel.border = element_blank(),\n          axis.text = element_blank(),\n          axis.title = element_blank(),\n          axis.ticks = element_blank(),\n          legend.position = c(.1,.2))+\n    ggtitle(\"County Pop. (Shapefile)\")\n\n  \n  map5<-ggplot()+\n    geom_map(data=dist_shp_f,map=dist_shp_f,aes(x=long,y=lat,map_id=id,fill=log(TOTAL)))+\n    scale_fill_gradientn(colours = c(\"grey100\",\"red2\"),guide=guide_colourbar(title=NULL),space=\"Lab\",na.value = \"grey60\")+\n    geom_map(data=cnty_shp_f,map=cnty_shp_f,aes(x=long,y=lat,map_id=id),color=\"grey45\",alpha=0,size=.1)+\n    theme(text = element_text(color = \"white\"),\n          rect = element_rect(fill = \"grey35\", color = \"grey35\"),\n          plot.background = element_rect(fill = \"grey35\", color = \"grey35\"),\n          panel.background = element_rect(fill = \"grey35\", color = \"grey35\"),\n          plot.title = element_text(),\n          panel.grid = element_blank(),\n          panel.border = element_blank(),\n          axis.text = element_blank(),\n          axis.title = element_blank(),\n          axis.ticks = element_blank(),\n          legend.position = c(.1,.2))+\n    ggtitle(\"District Pop. (Shapefile))\")\n\n  \n  map6<-ggplot()+\n    geom_map(data=clan_shp_f,map=clan_shp_f,aes(x=long,y=lat,map_id=id,fill=log(SUM_TOTAL)))+\n    scale_fill_gradientn(colours = c(\"grey100\",\"red2\"),guide=guide_colourbar(title=NULL),space=\"Lab\",na.value = \"grey60\")+\n    geom_map(data=cnty_shp_f,map=cnty_shp_f,aes(x=long,y=lat,map_id=id),color=\"grey45\",alpha=0,size=.1)+\n    theme(text = element_text(color = \"white\"),\n          rect = element_rect(fill = \"grey35\", color = \"grey35\"),\n          plot.background = element_rect(fill = \"grey35\", color = \"grey35\"),\n          panel.background = element_rect(fill = \"grey35\", color = \"grey35\"),\n          plot.title = element_text(),\n          panel.grid = element_blank(),\n          panel.border = element_blank(),\n          axis.text = element_blank(),\n          axis.title = element_blank(),\n          axis.ticks = element_blank(),\n          legend.position = c(.1,.2))+\n    ggtitle(\"Clan Pop. (Shapefile)\")\n\n  \n##\n  \n  \n#### V2. GPW4 ####\n  \n  ### LOAD GWP4 DATA ###\n  gpw4<-raster(\"~/Documents/W_M/Year_1/2017_Summer/Monroe_Project/gpw-v4-population-count_2010.tif\")\n  #gpw4\n  #plot(gpw4)\n  \n  ### JOIN DATA ###\n  \n  #country_gpw4<-extract(gpw4,country,df=TRUE)\n  #save(country_gpw4,file = \"country_gpw4.RData\")\n  load(\"country_gpw4.RData\")\n  country_gpw4_totals<-aggregate(.~ID,country_gpw4,sum)\n  country_gpw4_totals$ID<-as.character((country_gpw4_totals$ID-1))\n  names(country_gpw4_totals)[2]<-\"pop\"\n  country_gpw4_f<-left_join(x=country_f,y=country_gpw4_totals,by=c(\"id\"=\"ID\"))\n  \n  \n  #cnty_gpw4<-extract(gpw4,cnty,df=TRUE)\n  #save(cnty_gpw4,file = \"cnty_gpw4.RData\")\n  load(\"cnty_gpw4.RData\")\n  cnty_gpw4_totals<-aggregate(.~ID,cnty_gpw4,sum)\n  cnty_gpw4_totals$ID<-as.character((cnty_gpw4_totals$ID-1))\n  names(cnty_gpw4_totals)[2]<-\"pop\"\n  cnty_gpw4_f<-left_join(x=cnty_f,y=cnty_gpw4_totals,by=c(\"id\"=\"ID\"))\n  \n  \n  #dist_gpw4<-extract(gpw4,dist,df=TRUE)\n  #save(dist_gpw4,file = \"dist_gpw4.RData\")\n  load(\"dist_gpw4.RData\")\n  dist_gpw4_totals<-aggregate(.~ID,dist_gpw4,sum)\n  dist_gpw4_totals$ID<-as.character((dist_gpw4_totals$ID-1))\n  names(dist_gpw4_totals)[2]<-\"pop\"\n  dist_gpw4_f<-left_join(x=dist_f,y=dist_gpw4_totals,by=c(\"id\"=\"ID\"))\n  \n  \n  #clan_gpw4<-extract(gpw4,clan,df=TRUE)\n  #save(clan_gpw4,file = \"clan_gpw4.RData\")\n  load(\"clan_gpw4.RData\")\n  clan_gpw4_totals<-aggregate(.~ID,clan_gpw4,sum)\n  clan_gpw4_totals$ID<-as.character((clan_gpw4_totals$ID-1))\n  names(clan_gpw4_totals)[2]<-\"pop\"\n  clan_gpw4_f<-left_join(x=clan_f,y=clan_gpw4_totals,by=c(\"id\"=\"ID\"))\n  \n  \n  ### MAKE MAPS ###\n  # map0<-ggplot(country_gpw4_f, aes(x=long, y = lat))+\n  #           geom_map(data = country_gpw4_f, map=country_gpw4_f,aes(x=long, y=lat,map_id=id,fill=pop))+\n  #           scale_fill_gradient(low=\"yellow\",high=\"red\",space=\"Lab\")\n\n  \n  # map1<-ggplot(cnty_gpw4_f, aes(x=long, y = lat))+\n  #   geom_map(data = cnty_gpw4_f, map=cnty_gpw4_f,aes(x=long, y=lat,map_id=id,fill=pop))+\n  #   scale_fill_gradient(low=\"yellow\",high=\"red\",space=\"Lab\")\n  # map1\n  \n  map1<-ggplot()+\n    geom_map(data=cnty_gpw4_f,map=cnty_gpw4_f,aes(x=long,y=lat,map_id=id,fill=log(pop)))+\n    scale_fill_gradientn(colours = c(\"grey100\",\"red2\"),guide=guide_colourbar(title=NULL),space=\"Lab\",na.value = \"grey60\")+\n    geom_map(data=cnty_gpw4_f,map=cnty_gpw4_f,aes(x=long,y=lat,map_id=id),color=\"grey45\",alpha=0,size=.1)+\n    theme(text = element_text(color = \"white\"),\n          rect = element_rect(fill = \"grey35\", color = \"grey35\"),\n          plot.background = element_rect(fill = \"grey35\", color = \"grey35\"),\n          panel.background = element_rect(fill = \"grey35\", color = \"grey35\"),\n          plot.title = element_text(),\n          panel.grid = element_blank(),\n          panel.border = element_blank(),\n          axis.text = element_blank(),\n          axis.title = element_blank(),\n          axis.ticks = element_blank(),\n          legend.position = c(.1,.2))+\n    ggtitle(\"County Pop. (gpw4)\")\n  \n  # map2<-ggplot(dist_gpw4_f, aes(x=long, y = lat))+\n  #   geom_map(data = dist_gpw4_f, map=dist_gpw4_f,aes(x=long, y=lat,map_id=id,fill=pop))+\n  #   scale_fill_gradient(low=\"yellow\",high=\"red\",space=\"Lab\")\n  # map2\n  \n  map2<-ggplot()+\n    geom_map(data=dist_gpw4_f,map=dist_gpw4_f,aes(x=long,y=lat,map_id=id,fill=log(pop)))+\n    scale_fill_gradientn(colours = c(\"grey100\",\"red2\"),guide=guide_colourbar(title=NULL),space=\"Lab\",na.value = \"grey60\")+\n    geom_map(data=cnty_gpw4_f,map=cnty_gpw4_f,aes(x=long,y=lat,map_id=id),color=\"grey45\",alpha=0,size=.1)+\n    theme(text = element_text(color = \"white\"),\n          rect = element_rect(fill = \"grey35\", color = \"grey35\"),\n          plot.background = element_rect(fill = \"grey35\", color = \"grey35\"),\n          panel.background = element_rect(fill = \"grey35\", color = \"grey35\"),\n          plot.title = element_text(),\n          panel.grid = element_blank(),\n          panel.border = element_blank(),\n          axis.text = element_blank(),\n          axis.title = element_blank(),\n          axis.ticks = element_blank(),\n          legend.position = c(.1,.2))+\n    ggtitle(\"District Pop. (gpw4)\")\n  \n  # map3<-ggplot(clan_gpw4_f, aes(x=long, y = lat))+\n  #   geom_map(data = clan_gpw4_f, map=clan_gpw4_f,aes(x=long, y=lat,map_id=id,fill=pop))+\n  #   scale_fill_gradient(low=\"yellow\",high=\"red\",space=\"Lab\")\n  map3\n  \n  map3<-ggplot()+\n    geom_map(data=clan_gpw4_f,map=clan_gpw4_f,aes(x=long,y=lat,map_id=id,fill=log(pop)))+\n    scale_fill_gradientn(colours = c(\"grey100\",\"red2\"),guide=guide_colourbar(title=NULL),space=\"Lab\",na.value = \"grey60\")+\n    geom_map(data=cnty_gpw4_f,map=cnty_gpw4_f,aes(x=long,y=lat,map_id=id),color=\"grey45\",alpha=0,size=.1)+\n    theme(text = element_text(color = \"white\"),\n          rect = element_rect(fill = \"grey35\", color = \"grey35\"),\n          plot.background = element_rect(fill = \"grey35\", color = \"grey35\"),\n          panel.background = element_rect(fill = \"grey35\", color = \"grey35\"),\n          plot.title = element_text(),\n          panel.grid = element_blank(),\n          panel.border = element_blank(),\n          axis.text = element_blank(),\n          axis.title = element_blank(),\n          axis.ticks = element_blank(),\n          legend.position = c(.1,.2))+\n    ggtitle(\"Clan Pop. (gpw4)\")\n\n##\ncomparison<-arrangeGrob(map1,map4,map2,map5,map3,map6,nrow=3,ncol=2)\nggsave(\"comparison.png\",comparison,width = 20, height = 18, dpi = 150)\n##\n\n\n#### V3. SURVEY DATA ####\nload(\"cwiq10.RData\")\n\ncnty_survey_cpts <- cbind.data.frame(county_id = counties@data$FIRST_CCOD, county_labs, stringsAsFactors = FALSE)\ndist_survey_cpts <- cbind.data.frame(county_id = districts@data$FIRST_CCOD, district_id = districts@data$FIRST_DCOD, district_labs)\nclan_survey_cpts <- cbind.data.frame(county_id = clans@data$FIRST_CCOD, district_id = clans@data$FIRST_DCOD, clan_id = clans@data$FIRST_CLCO, clan_labs)\n\n# Counties\n# table(cnty_survey_cpts$county_id)\n# table(cwiq10$county)\ncwiq10$county <- substr(cwiq10$hid_mungai,1,2)\ncwiq10$county[cwiq10$county == \"01\"] <- \"30\"\ncounty_cwiq10 <- left_join(x = cnty_survey_cpts, y = cwiq10, by = c(\"county_id\" = \"county\"))\n\n# Districts\n# length(table(dist_survey_cpts$district_code))\n# length(table(cwiq10$district_code))\ncwiq10$district <- substr(cwiq10$hid_mungai,3,4)\ndist_survey_cpts$district_code  <- paste(dist_survey_cpts$county_id, dist_survey_cpts$district_id, sep = \"\")\ncwiq10$district_code <- paste(cwiq10$county, cwiq10$district, sep= \"\")\ndistrict_cwiq10 <- left_join(x = dist_survey_cpts, y = cwiq10, by = c(\"district_code\" = \"district_code\"))\n# anti_join(x = dist_survey_cpts, y = cwiq10, by = c(\"district_code\" = \"district_code\"))\n# anti_join(x = cwiq10, y = dist_survey_cpts, by = c(\"district_code\" = \"district_code\"))\n\n# Clans\ncwiq10$clan_town <- substr(cwiq10$hid_mungai,5,7)\nclan_survey_cpts$clan_code  <- paste(clan_survey_cpts$county_id, clan_survey_cpts$district_id, clan_survey_cpts$clan_id, sep = \"\")\ncwiq10$clan_town_code <- paste(cwiq10$county, cwiq10$district, cwiq10$clan_town, sep= \"\")\nclan_cwiq10 <- left_join(x = clan_survey_cpts, y = cwiq10, by = c(\"clan_code\" = \"clan_town_code\"))\n# anti_join(x = clan_survey_cpts, y = cwiq10, by = c(\"clan_code\" = \"clan_town_code\"))\n# anti_join(x = cwiq10, y = clan_survey_cpts, by = c(\"clan_town_code\" = \"clan_code\"))\n\n# Being Analyzing Point Pattern\n\n#Add National boundary for Liberia\n\noptions(scipen=999)\n\ncountry <- readOGR(dsn=\"shapefiles\", layer=\"liberia_revised\", stringsAsFactors=FALSE, verbose=FALSE)\nproj4string(country)\ncountry <- spTransform(country, CRS(\"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0\"))\n\nwin <- as(country,\"owin\")\n\ncnty_weights <- county_cwiq10$wta_hh\ndist_weights <- district_cwiq10$wta_hh\nclan_weights <- clan_cwiq10$wta_hh\n\n# Total Population\n\nlbr_cnty <- ppp(x = county_cwiq10$x, y = county_cwiq10$y, window = win, marks = cnty_weights)\nlbr_dist <- ppp(x = district_cwiq10$x, y = district_cwiq10$y, window = win, marks = dist_weights)\nlbr_clan <- ppp(x = clan_cwiq10$x, y = clan_cwiq10$y, window = win, marks = clan_weights)\n\n\npar(mar=c(0,0,1,0))\n\npng(\"latex/pop_county.png\")\nplot(density(lbr_cnty), main = \"County Weights\")\ndev.off()\n\npng(\"latex/pop_district.png\")\nplot(density(lbr_dist), main = \"District Weights\")\ndev.off()\n\npng(\"latex/pop_clan.png\")\nplot(density(lbr_clan), main = \"Clan Weights\")\ndev.off()\n\n\n# Population by Gender\n\ncnty_gender <- as.factor(county_cwiq10$n1)\ndist_gender <- as.factor(district_cwiq10$n1)\nclan_gender <- as.factor(clan_cwiq10$n1)\n\nlevels(cnty_gender) <- c(\"male\", \"female\")\nlevels(dist_gender) <- c(\"male\", \"female\")\nlevels(clan_gender) <- c(\"male\", \"female\")\n\nlbr_cnty_gender <- ppp(x = county_cwiq10$x, y = county_cwiq10$y, window = win, marks = cnty_gender)\nlbr_dist_gender <- ppp(x = district_cwiq10$x, y = district_cwiq10$y, window = win, marks = dist_gender)\nlbr_clan_gender <- ppp(x = clan_cwiq10$x, y = clan_cwiq10$y, window = win, marks = clan_gender)\n\npar(oma=c(0,0,0,0))\npar(mar=c(0,0,0,0))\n\npdf(\"latex/gender_county.pdf\", width = 10, height = 5)\nplot(density(split(lbr_cnty_gender, weights = cnty_weights)), main = NA)\ndev.off()\n\npdf(\"latex/gender_district.pdf\", width = 10, height = 5)\nplot(density(split(lbr_dist_gender, weights = dist_weights)), main = NA)\ndev.off()\n\npdf(\"latex/gender_clan.pdf\", width = 10, height = 5)\nplot(density(split(lbr_clan_gender, weights = clan_weights)), main = NA)\ndev.off()\n\n#Female Population\n\ncnty_gender_female <- subset(county_cwiq10, n1 == 2)\ndist_gender_female <- subset(district_cwiq10, n1 == 2)\nclan_gender_female <- subset(clan_cwiq10, n1 == 2)\n\ncnty_female_ppp <- ppp(x = cnty_gender_female$x, y = cnty_gender_female$y, window = win, marks = cnty_gender_female$wta_hh)\ndist_female_ppp <- ppp(x = dist_gender_female$x, y = dist_gender_female$y, window = win, marks = dist_gender_female$wta_hh)\nclan_female_ppp <- ppp(x = clan_gender_female$x, y = clan_gender_female$y, window = win, marks = clan_gender_female$wta_hh)\n\npdf(\"latex/female_county.pdf\")\nplot(density(cnty_female_ppp), main = \"County Weights\")\ndev.off()\n\npdf(\"latex/female_dist.pdf\")\nplot(density(dist_female_ppp), main = \"District Weights\")\ndev.off()\n\npdf(\"latex/female_clan.pdf\")\nplot(density(clan_female_ppp), main = \"Clan Weights\")\ndev.off()\n\n#Male Population\n\ncnty_gender_male <- subset(county_cwiq10, n1 == 1)\ndist_gender_male <- subset(district_cwiq10, n1 == 1)\nclan_gender_male <- subset(clan_cwiq10, n1 == 1)\n\ncnty_male_ppp <- ppp(x = cnty_gender_male$x, y = cnty_gender_male$y, window = win, marks = cnty_gender_male$wta_hh)\ndist_male_ppp <- ppp(x = dist_gender_male$x, y = dist_gender_male$y, window = win, marks = dist_gender_male$wta_hh)\nclan_male_ppp <- ppp(x = clan_gender_male$x, y = clan_gender_male$y, window = win, marks = clan_gender_male$wta_hh)\n\npdf(\"latex/male_county.pdf\")\nplot(density(cnty_male_ppp), main = \"County Weights\")\ndev.off()\n\npdf(\"latex/male_dist.pdf\")\nplot(density(dist_male_ppp), main = \"District Weights\")\ndev.off()\n\npdf(\"latex/male_clan.pdf\")\nplot(density(clan_male_ppp), main = \"Clan Weights\")\ndev.off()\n\n# Ethnicity in Montserrado County\n\n#Base map Montserrado\ncoastal_lbr <- get_map(location = c(-11.00, 6.10, -10.25, 6.85), maptype = \"watercolor\")\ncoastal_lbr <- ggmap(coastal_lbr)\n\ncoastal_lbr <- coastal_lbr + geom_map(data=clans_f,map=clans_f,aes(x=long, y=lat, map_id=id,fill = log10(SUM_TOTAL)))\ncoastal_lbr <- coastal_lbr + geom_map(data=counties_f,map=counties_f,aes(x=long, y=lat, map_id=id), color =\"white\", alpha = 0, size = 1.5)\ncoastal_lbr <- coastal_lbr + geom_map(data=africa_f,map=africa_f,aes(x=long, y=lat, map_id=id), color =\"white\", alpha = 0, size = 1.5)\ncoastal_lbr <- coastal_lbr + scale_fill_gradient(low=\"yellow\", high=\"red\", space=\"Lab\")\ncoastal_lbr <- coastal_lbr + annotate('text', x = county_labs$x, y = county_labs$y, label = county_labs$county, size = 4)\ncoastal_lbr <- coastal_lbr + annotate('text', x = country_labs$x, y = country_labs$y, label = country_labs$country, size = 8)\ncoastal_lbr <- coastal_lbr + ggtitle(\"Clans\")\nggsave(\"latex/clans_coastal_lbr.pdf\", coastal_lbr, width = 10, height = 10, dpi = 300)\n\npar(mar=c(0,0,1,1))\n\nclan_ethnic_bassa <- subset(clan_cwiq10, n11 == 1)\nclan_ethnic_kpelle <- subset(clan_cwiq10, n11 == 8)\nclan_ethnic_kissi <- subset(clan_cwiq10, n11 == 9)\nclan_ethnic_lorma <- subset(clan_cwiq10, n11 == 12)\n\nmontserrado <- subset(clans, FIRST_CCOD == 30 )\n\nm_win <- as(montserrado,\"owin\")\n\nclan_monts_bassa <- ppp(x = clan_ethnic_bassa$x, y = clan_ethnic_bassa$y, window = m_win, marks = clan_ethnic_bassa$wta_hh)\nclan_monts_kpelle <- ppp(x = clan_ethnic_kpelle$x, y = clan_ethnic_kpelle$y, window = m_win, marks = clan_ethnic_kpelle$wta_hh)\nclan_monts_kissi <- ppp(x = clan_ethnic_kissi$x, y = clan_ethnic_kissi$y, window = m_win, marks = clan_ethnic_kissi$wta_hh)\nclan_monts_lorma <- ppp(x = clan_ethnic_lorma$x, y = clan_ethnic_lorma$y, window = m_win, marks = clan_ethnic_lorma$wta_hh)\n\npdf(\"latex/clan_monts_bassa.pdf\")\nplot(density(clan_monts_bassa), main = \"Bassa\")\ndev.off()\n\npdf(\"latex/clan_monts_kpelle.pdf\")\nplot(density(clan_monts_kpelle), main = \"Kpelle\")\ndev.off()\n\npdf(\"latex/clan_monts_kissi.pdf\")\nplot(density(clan_monts_kissi), main = \"Kissi\")\ndev.off()\n\npdf(\"latex/clan_monts_lorma.pdf\")\nplot(density(clan_monts_lorma), main = \"Lorma\")\ndev.off()\n\n# Compare Religion and Education across Liberia\n\nclan_religion_christian <- subset(clan_cwiq10, n12 == 1)\nclan_religion_muslim <- subset(clan_cwiq10, n12 == 2)\nclan_edu_none <- subset(clan_cwiq10, o3 == 0)\nclan_edu_p6 <- subset(clan_cwiq10, o3 == 16)\nclan_edu_sh12 <- subset(clan_cwiq10, o3 == 26)\nclan_edu_uni <- subset(clan_cwiq10, o3 == 31)\n\n\nclan_cnty_christian <- ppp(x = clan_religion_christian$x, y = clan_religion_christian$y, window = win, marks = clan_religion_christian$wta_hh)\nclan_cnty_muslim <- ppp(x = clan_religion_muslim$x, y = clan_religion_muslim$y, window = win, marks = clan_religion_muslim$wta_hh)\nclan_cnty_none <- ppp(x = clan_edu_none$x, y = clan_edu_none$y, window = win, marks = clan_edu_none$wta_hh)\nclan_cnty_p6 <- ppp(x = clan_edu_p6$x, y = clan_edu_p6$y, window = win, marks = clan_edu_p6$wta_hh)\nclan_cnty_sh12 <- ppp(x = clan_edu_sh12$x, y = clan_edu_sh12$y, window = win, marks = clan_edu_sh12$wta_hh)\nclan_cnty_uni <- ppp(x = clan_edu_uni$x, y = clan_edu_uni$y, window = win, marks = clan_edu_uni$wta_hh)\n\npar(mar=c(0,0,1,1))\n\npdf(\"latex/clan_cnty_christian.pdf\")\nplot(density(clan_cnty_christian), main = \"Christian\")\ndev.off()\n\npdf(\"latex/clan_cnty_muslim.pdf\")\nplot(density(clan_cnty_muslim), main = \"Muslim\")\ndev.off()\n\npdf(\"latex/clan_cnty_none.pdf\")\nplot(density(clan_cnty_none), main = \"No Education\")\ndev.off()\n\npdf(\"latex/clan_cnty_p6.pdf\")\nplot(density(clan_cnty_p6), main = \"Grade School\")\ndev.off()\n\npdf(\"latex/clan_cnty_sh12.pdf\")\nplot(density(clan_cnty_sh12), main = \"High School\")\ndev.off()\n\npdf(\"latex/clan_cnty_uni.pdf\")\nplot(density(clan_cnty_uni), main = \"University\")\ndev.off()\n\n# Compare Religion and Education in Montserrado\n\nclan_mont_christian <- ppp(x = clan_religion_christian$x, y = clan_religion_christian$y, window = m_win, marks = clan_religion_christian$wta_hh)\nclan_mont_muslim <- ppp(x = clan_religion_muslim$x, y = clan_religion_muslim$y, window = m_win, marks = clan_religion_muslim$wta_hh)\nclan_mont_none <- ppp(x = clan_edu_none$x, y = clan_edu_none$y, window = m_win, marks = clan_edu_none$wta_hh)\nclan_mont_p6 <- ppp(x = clan_edu_p6$x, y = clan_edu_p6$y, window = m_win, marks = clan_edu_p6$wta_hh)\nclan_mont_sh12 <- ppp(x = clan_edu_sh12$x, y = clan_edu_sh12$y, window = m_win, marks = clan_edu_sh12$wta_hh)\nclan_mont_uni <- ppp(x = clan_edu_uni$x, y = clan_edu_uni$y, window = m_win, marks = clan_edu_uni$wta_hh)\n\npar(mar=c(0,0,1,1))\n\npdf(\"latex/clan_mont_christian.pdf\")\nplot(density(clan_mont_christian), main = \"Christian\")\ndev.off()\n\npdf(\"latex/clan_mont_muslim.pdf\")\nplot(density(clan_mont_muslim), main = \"Muslim\")\ndev.off()\n\npdf(\"latex/clan_mont_none.pdf\")\nplot(density(clan_mont_none), main = \"No Education\")\ndev.off()\n\npdf(\"latex/clan_mont_p6.pdf\")\nplot(density(clan_mont_p6), main = \"Grade School\")\ndev.off()\n\npdf(\"latex/clan_mont_sh12.pdf\")\nplot(density(clan_mont_sh12), main = \"High School\")\ndev.off()\n\npdf(\"latex/clan_mont_uni.pdf\")\nplot(density(clan_mont_uni), main = \"University\")\ndev.off()\n\n\n\n# Population by Age\n\ncnty_age <- cut(county_cwiq10$n4, 4)\ndist_age <- cut(district_cwiq10$n4, 4)\nclan_age <- cut(clan_cwiq10$n4, 4)\n\nlbr_cnty_age <- ppp(x = county_cwiq10$x, y = county_cwiq10$y, window = win, marks = cnty_age)\nlbr_dist_age <- ppp(x = district_cwiq10$x, y = district_cwiq10$y, window = win, marks = dist_age)\nlbr_clan_age <- ppp(x = clan_cwiq10$x, y = clan_cwiq10$y, window = win, marks = clan_age)\n\nplot(density(split(lbr_cnty_age, weights = cnty_weights)))\nplot(density(split(lbr_dist_age, weights = dist_weights)))\nplot(density(split(lbr_clan_age, weights = clan_weights)))\n\n# Ethnicity\n\ncnty_ethnic <- as.factor(county_cwiq10$n11)\ndist_ethnic <- as.factor(district_cwiq10$n11)\nclan_ethnic <- as.factor(clan_cwiq10$n11)\n\nlevels(cnty_ethnic) <- c(\"bassa\", \"belle\", \"dey\", \"gbandi\", \"gio\", \"gola\", \"grebo\", \"kpelle\", \"kissi\", \"krahn\", \"kru\", \"lorma\", \"mandingo\", \"mano\", \"mende\", \"sapo\", \"vai\", \"naturalized\", \"congo/american\")\nlevels(dist_ethnic) <- c(\"bassa\", \"belle\", \"dey\", \"gbandi\", \"gio\", \"gola\", \"grebo\", \"kpelle\", \"kissi\", \"krahn\", \"kru\", \"lorma\", \"mandingo\", \"mano\", \"mende\", \"sapo\", \"vai\", \"naturalized\", \"congo/american\")\nlevels(clan_ethnic) <- c(\"bassa\", \"belle\", \"dey\", \"gbandi\", \"gio\", \"gola\", \"grebo\", \"kpelle\", \"kissi\", \"krahn\", \"kru\", \"lorma\", \"mandingo\", \"mano\", \"mende\", \"sapo\", \"vai\", \"naturalized\", \"congo/american\")\n\nlbr_cnty_ethnic <- ppp(x = county_cwiq10$x, y = county_cwiq10$y, window = win, marks = cnty_ethnic)\nlbr_dist_ethnic <- ppp(x = district_cwiq10$x, y = district_cwiq10$y, window = win, marks = dist_ethnic)\nlbr_clan_ethnic <- ppp(x = clan_cwiq10$x, y = clan_cwiq10$y, window = win, marks = clan_ethnic)\n\nplot(density(split(lbr_cnty_ethnic, weights = cnty_weights)))\nplot(density(split(lbr_dist_ethnic, weights = dist_weights)))\nplot(density(split(lbr_clan_ethnic, weights = clan_weights)))\n\n# Religion\n\ncnty_religion <- as.factor(county_cwiq10$n12)\ndist_religion <- as.factor(district_cwiq10$n12)\nclan_religion <- as.factor(clan_cwiq10$n12)\n\nlevels(cnty_religion) <- c(\"christian\", \"muslim\", \"traditional\", \"other\", \"none\")\nlevels(dist_religion) <- c(\"christian\", \"muslim\", \"traditional\", \"other\", \"none\")\nlevels(clan_religion) <- c(\"christian\", \"muslim\", \"traditional\", \"other\", \"none\")\n\nlbr_cnty_religion <- ppp(x = county_cwiq10$x, y = county_cwiq10$y, window = win, marks = cnty_religion)\nlbr_dist_religion <- ppp(x = district_cwiq10$x, y = district_cwiq10$y, window = win, marks = dist_religion)\nlbr_clan_religion <- ppp(x = clan_cwiq10$x, y = clan_cwiq10$y, window = win, marks = clan_religion)\n\nplot(density(split(lbr_cnty_religion, weights = cnty_weights)))\nplot(density(split(lbr_dist_religion, weights = dist_weights)))\nplot(density(split(lbr_clan_religion, weights = clan_weights)))\n\n# Education\n\ncnty_edu <- as.factor(county_cwiq10$o3)\ndist_edu <- as.factor(district_cwiq10$o3)\nclan_edu <- as.factor(clan_cwiq10$o3)\n\nlevels(cnty_edu) <- c(\"none\", \"pre-school\", \"p1\", \"p2\", \"p3\", \"p4\", \"p5\", \"p6\", \"s7\", \"s8\", \"s9\", \"sh10\", \"sh11\", \"sh12\", \"university\", \"vocational\", \"tech-training\", \"technical\")\nlevels(dist_edu) <- c(\"none\", \"pre-school\", \"p1\", \"p2\", \"p3\", \"p4\", \"p5\", \"p6\", \"s7\", \"s8\", \"s9\", \"sh10\", \"sh11\", \"sh12\", \"university\", \"vocational\", \"tech-training\", \"technical\")\nlevels(clan_edu) <- c(\"none\", \"pre-school\", \"p1\", \"p2\", \"p3\", \"p4\", \"p5\", \"p6\", \"s7\", \"s8\", \"s9\", \"sh10\", \"sh11\", \"sh12\", \"university\", \"vocational\", \"tech-training\", \"technical\")\n\nlbr_cnty_edu <- ppp(x = county_cwiq10$x, y = county_cwiq10$y, window = win, marks = cnty_edu)\nlbr_dist_edu <- ppp(x = district_cwiq10$x, y = district_cwiq10$y, window = win, marks = dist_edu)\nlbr_clan_edu <- ppp(x = clan_cwiq10$x, y = clan_cwiq10$y, window = win, marks = clan_edu)\n\nplot(density(split(lbr_cnty_edu, weights = cnty_weights)), main = \"Education - County Weights\")\nplot(density(split(lbr_dist_edu, weights = dist_weights)), main = \"Education - District Weights\")\nplot(density(split(lbr_clan_edu, weights = clan_weights)), main = \"Education - Clan Weights\")\n\n\n\n\n\n\n\n#contour(density(liberia_gender, weights = weights))\n\nlbr_dist_gender <- ppp(x = district_cwiq10$x, y = district_cwiq10$y, window = win, marks = gender)\nplot(density(lbr_cnty_gender, weights = weights))\nplot(density(split(lbr_cnty_gender, weights = weights)))\n\n\n### LABELING ###\n\n# country_names <- africa@data$COUNTRY\n# country_cpts <- gCentroid(africa, byid=TRUE)\n# country_labs <- cbind.data.frame(country_names, country_cpts@coords[,1], country_cpts@coords[,2])\n# names(country_labs) <- c(\"country\",\"x\",\"y\")\n# country_labs[1,2] <- -7.75 #modify Cote d'Ivore location\n# country_labs[1,3] <- 6.75\n# country_labs[2,2] <- -9.00 #modify Guinea location\n# country_labs[2,3] <- 8.4\n# country_labs[3,2] <- -11.15 #modify Guinea location\n# country_labs[3,3] <- 8.00\n\nlbr_1_names <- lbr_1@data$CCNAME\nlbr_1_cpts <- gCentroid(lbr_1, byid=TRUE)\nlbr_1_labs <- cbind.data.frame(lbr_1_names, lbr_1_cpts@coords[,1], lbr_1_cpts@coords[,2])\nnames(lbr_1_labs) <- c(\"lbr_1\",\"x\",\"y\")\nlbr_1_labs[9,3] <- 6.65 # Margibi lbr_1 location\nlbr_1_labs[9,2] <- -10.25\n\n# counties_d <- counties@data[,c(2,4:7)]\n# counties_d$id <- row.names(counties)\n# counties_f <- left_join(x = counties_f, y = counties_d, by = c(\"id\" = \"id\"))\n\ndistrict_names <- districts@data$DNAME\ndistrict_cpts <- gCentroid(districts, byid=TRUE)\ndistrict_labs <- cbind.data.frame(district_names, district_cpts@coords[,1], district_cpts@coords[,2])\nnames(district_labs) <- c(\"district\",\"x\",\"y\")\n\n# districts_d <- districts@data[,c(1,7:10)]\n# districts_d$id <- row.names(districts)\n# districts_f <- left_join(x = districts_f, y = districts_d, by = c(\"id\" = \"id\"))\n\nlbr_3_names <- lbr_3@data$CLNAME\nlbr_3_cpts <- gCentroid(lbr_3, byid=TRUE)\nlbr_3_labs <- cbind.data.frame(lbr_3_names, lbr_3_cpts@coords[,1], lbr_3_cpts@coords[,2])\nnames(lbr_3_labs) <- c(\"clans\",\"x\",\"y\")\n\n# clans_d <- clans@data[,c(1,5:8)]\n# clans_d$id <- row.names(clans)\n# clans_f <- left_join(x = clans_f, y = clans_d, by = c(\"id\" = \"id\"))\n\n\n# LOAD CWIQ10 DATA AND JOIN TO GOV SUBDIVISION CENTER POINTS\nload(\"cwiq10.RData\")\n\ncnty_survey_cpts <- cbind.data.frame(county_id = counties@data$FIRST_CCOD, county_labs, stringsAsFactors = FALSE)\ndist_survey_cpts <- cbind.data.frame(county_id = districts@data$FIRST_CCOD, district_id = districts@data$FIRST_DCOD, district_labs)\n\n\nlbr_3_survey_cpts <- cbind.data.frame(county_id = lbr_3@data$FIRST_CCOD, district_id = lbr_3@data$FIRST_DCOD, clan_id = lbr_3@data$FIRST_CLCO, lbr_3_labs)\ncwiq10$clan_town <- substr(cwiq10$hid_mungai,5,7)\nlbr_3_survey_cpts$clan_code  <- paste(lbr_3_survey_cpts$county_id, lbr_3_survey_cpts$district_id, lbr_3_survey_cpts$clan_id, sep = \"\")\ncwiq10$clan_town_code <- paste(cwiq10$county, cwiq10$district, cwiq10$clan_town, sep= \"\")\nlbr_3_cwiq10 <- left_join(x = lbr_3_survey_cpts, y = cwiq10, by = c(\"clan_code\" = \"clan_town_code\"))\n\n# Counties\n# table(cnty_survey_cpts$county_id)\n# table(cwiq10$county)\ncwiq10$county <- substr(cwiq10$hid_mungai,1,2)\ncwiq10$county[cwiq10$county == \"01\"] <- \"30\"\ncounty_cwiq10 <- left_join(x = cnty_survey_cpts, y = cwiq10, by = c(\"county_id\" = \"county\"))\n\n# Districts\n# length(table(dist_survey_cpts$district_code))\n# length(table(cwiq10$district_code))\ncwiq10$district <- substr(cwiq10$hid_mungai,3,4)\ndist_survey_cpts$district_code  <- paste(dist_survey_cpts$county_id, dist_survey_cpts$district_id, sep = \"\")\ncwiq10$district_code <- paste(cwiq10$county, cwiq10$district, sep= \"\")\ndistrict_cwiq10 <- left_join(x = dist_survey_cpts, y = cwiq10, by = c(\"district_code\" = \"district_code\"))\n# anti_join(x = dist_survey_cpts, y = cwiq10, by = c(\"district_code\" = \"district_code\"))\n# anti_join(x = cwiq10, y = dist_survey_cpts, by = c(\"district_code\" = \"district_code\"))\n\n# Clans\ncwiq10$clan_town <- substr(cwiq10$hid_mungai,5,7)\nlbr_3_survey_cpts$clan_code  <- paste(lbr_3_survey_cpts$county_id, lbr_3_survey_cpts$district_id, lbr_3_survey_cpts$clan_id, sep = \"\")\ncwiq10$clan_town_code <- paste(cwiq10$county, cwiq10$district, cwiq10$clan_town, sep= \"\")\nlbr_3_cwiq10 <- left_join(x = lbr_3_survey_cpts, y = cwiq10, by = c(\"clan_code\" = \"clan_town_code\"))\n# anti_join(x = clan_survey_cpts, y = cwiq10, by = c(\"clan_code\" = \"clan_town_code\"))\n# anti_join(x = cwiq10, y = clan_survey_cpts, by = c(\"clan_town_code\" = \"clan_code\"))\n\nx<-sum(lbr_3_cwiq10$wta_hh,na.rm=T)\n\ny<-unique(lbr_3@data$FIRST_CLCO)\nz<-unique(cwiq10$clan_town)\na<-unique(lbr_3_cwiq10$clans)\nb<-subset(a, !(a %in% lbr_3@data$CLNAME))\nlbr_3@data$CLNAME\nlbr_3@polygons[319]\n\nunique(lbr_3$CLNAME)\nunique(lbr_3_cwiq10$district_id)\n\nlbr_3_cwiq10$dist_code<-paste(lbr_3_cwiq10$county_id,lbr_3_cwiq10$district_id)\n\ntest2<-subset(lbr_3_cwiq10, is.na(lbr_3_cwiq10$wta_hh))\n\ntest<-aggregate(wta_hh ~ county_id, lbr_3_cwiq10, sum)\n\nunique(lbr_3$FIRST_CCOD)\n\nwin<-as(lbr_1@polygons[[1]]@Polygons[[1]]@coords,\"owin\")\n\nlbr_1@polygons[1]\n\n# Being Analyzing Point Pattern\n\n#Add National boundary for Liberia\n\noptions(scipen=999)\n\ncountry <- readOGR(dsn=\"shapefiles\", layer=\"liberia_revised\", stringsAsFactors=FALSE, verbose=FALSE)\nproj4string(country)\ncountry <- spTransform(country, CRS(\"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0\"))\n\nwin <- as(country,\"owin\")\n\n\n\ncnty_weights <- county_cwiq10$wta_hh\ndist_weights <- district_cwiq10$wta_hh\nclan_weights <- clan_cwiq10$wta_hh\n\n# Total Population\n\nlbr_cnty <- ppp(x = county_cwiq10$x, y = county_cwiq10$y, window = win, marks = cnty_weights)\nlbr_dist <- ppp(x = district_cwiq10$x, y = district_cwiq10$y, window = win, marks = dist_weights)\nlbr_clan <- ppp(x = clan_cwiq10$x, y = clan_cwiq10$y, window = win, marks = clan_weights)\n\nplot(lbr_cnty)\n\npar(mar=c(0,0,1,0))\n\n\nplot.new()\nx<-density(lbr_cnty)\nclass(x)\ny<-as.data.frame.im(x)\nggplot(counties_f, aes(x=long,y=lat))+\n  geom_map(data=counties_f,map = counties_f,aes(x=long, y=lat,map_id=id))#+\n#geom_point(data=y,aes(x=x,y=y,colour=value),cex=1)+\n#scale_fill_gradient(low=\"red\",high=\"orange\",guide=guide_colourbar(title=NULL),space=\"Lab\",na.value = \"grey60\")\n\npoints(clans_f$long,clans_f$lat,cex=.001)\n\n\nsummary(x)\npng(\"latex/pop_district.png\")\nplot(density(lbr_dist), main = \"District Weights\")\ndev.off()\n\npng(\"latex/pop_clan.png\")\nplot(density(lbr_clan), main = \"Clan Weights\")\ndev.off()\n\n\n\n#### GPW4 EXTRACTION ####\n\n## Calculate growth rate ##\ngrowth_00_05<-overlay(gpw4_2000,gpw4_2005,fun=function(r1,r2){return((r2-r1)/r1)})\ngrowth_05_10<-overlay(gpw4_2005,gpw4_2010,fun=function(r1,r2){return((r2-r1)/r1)})\ngrowth_10_15<-overlay(gpw4_2010,gpw4_2015,fun=function(r1,r2){return((r2-r1)/r1)})\n\n## Extract location and values ##\ndata<-cbind(xyFromCell(gpw4_2000,1:ncell(gpw4_2000)),getValues(gpw4_2000))\ndata<-na.omit(data)\ncolnames(data)<-c(\"long\",\"lat\",\"pop2000\")\n\ndata2<-cbind(xyFromCell(gpw4_2005,1:ncell(gpw4_2005)),getValues(gpw4_2005))\ndata2<-na.omit(data2)\ncolnames(data2)<-c(\"long\",\"lat\",\"pop2005\")\n\ndata3<-cbind(xyFromCell(gpw4_2010,1:ncell(gpw4_2010)),getValues(gpw4_2010))\ndata3<-na.omit(data3)\ncolnames(data3)<-c(\"long\",\"lat\",\"pop2010\")\n\ndata4<-cbind(xyFromCell(gpw4_2015,1:ncell(gpw4_2015)),getValues(gpw4_2015))\ndata4<-na.omit(data4)\ncolnames(data4)<-c(\"long\",\"lat\",\"pop2015\")\n\ndata5<-cbind(xyFromCell(growth_00_05,1:ncell(growth_00_05)),getValues(growth_00_05))\ndata5<-na.omit(data5)\ncolnames(data5)<-c(\"long\",\"lat\",\"growth05\")\n\ndata6<-cbind(xyFromCell(growth_05_10,1:ncell(growth_05_10)),getValues(growth_05_10))\ndata6<-na.omit(data6)\ncolnames(data6)<-c(\"long\",\"lat\",\"growth10\")\n\ndata7<-cbind(xyFromCell(growth_10_15,1:ncell(growth_10_15)),getValues(growth_10_15))\ndata7<-na.omit(data7)\ncolnames(data7)<-c(\"long\",\"lat\",\"growth15\")\n\ndata_final<-merge(data,data2,by=c(\"long\",\"lat\"))\ndata_final<-merge(data_final,data3,by=c(\"long\",\"lat\"))\ndata_final<-merge(data_final,data4,by=c(\"long\",\"lat\"))\ndata_final<-merge(data_final,data5,by=c(\"long\",\"lat\"))\ndata_final<-merge(data_final,data6,by=c(\"long\",\"lat\"))\ndata_final<-merge(data_final,data7,by=c(\"long\",\"lat\"))\ndata_final[,10]<-1:nrow(data_final)\ncolnames(data_final)[10]<-\"id\"\n\n## Get city points ##\ncity_points<-read.csv(\"liberia_city_names.csv\")\ncity_points<-distinct(city_points,Latitude,Longitude,.keep_all = T)\n\nload(\"comNames.RData\")\n\n\n## Test Plots ##\n\nwin<-as(country,\"owin\")\nppp<-ppp(data_final$long,data_final$lat,marks=data_final$pop2010,window=win)\nppp2<-as.ppp(data_final,W=win)\nplot.ppp(ppp,cols=ppp$marks)\nplot(density(ppp,1))\n\n\n\ngplot(gpw4_2000)+geom_map(data=country_f,map=country_f,aes(x=long,y=lat,map_id=id))+geom_tile(aes(fill = value))\ngplot(growth_00_05)+geom_map(data=country_f,map=country_f,aes(x=long,y=lat,map_id=id))+geom_tile(aes(fill = value))+geom_point(data=city_points2,aes(x=Longitude,y=Latitude),cex=.01)\n\n\n\n\n#### LBR Overlay SHP on LEVEL.PLOT ####\n#This section will have some code from other sections so that anyone can just copy paste just this section out\n\n\n###PLOTTING###\n##2000-2015##\ngpw42000<- crop(gpw42000, extent(-11.55, -7.3, 4.2, 8.6))\nm2000 <- levelplot(gpw42000,at=piplup, main = \"2000\", col.regions=terrain.colors(25)) + layer(sp.polygons(lbr_1, col = \"black\"))\n\n\ngpw42005<- crop(gpw42005, extent(-11.55, -7.3, 4.2, 8.6))\nm2005 <- levelplot(gpw42005,at=piplup, main = \"2005\", col.regions=terrain.colors(25)) + layer(sp.polygons(lbr_1, col = \"black\"))\n\n\ngpw42010<- crop(gpw42010, extent(-11.55, -7.3, 4.2, 8.6))\nm2010 <- levelplot(gpw42010,at=piplup, main = \"2010\", col.regions=terrain.colors(25)) + layer(sp.polygons(lbr_1, col = \"black\"))\n\n\ngpw42015<- crop(gpw42015, extent(-11.55, -7.3, 4.2, 8.6))\nm2015 <- levelplot(gpw42015,at=piplup, main = \"2015\", col.regions=terrain.colors(25)) + layer(sp.polygons(lbr_1, col = \"black\"))\n\nyrcom00_15_.01_to_100_by_5 <- arrangeGrob(m2000,m2005,m2010,m2015,nrow=2,ncol=2)\nggsave(\"lbr_com_shp_rcom00_15_.01_to_100_by_5.png\",yrcom00_15_.01_to_100_by_5,width = 26, height = 24, dpi = 150)\n\n##Growth Rate##\n\nr00_15 <- (gpw42015-gpw42000)/(gpw42000)\nr00_15m <- levelplot(r00_15, col.regions=heat.colors(20), main = \"Lbr Growth Rate 2000-2015\") + layer(sp.polygons(lbr_0, col = \"black\"))\n\nr00_05 <- (gpw42005-gpw42000)/(gpw42000)\nr00_05m <- levelplot(r00_05, col.regions=heat.colors(20), main = \"Lbr Growth Rate 2000-2005\") + layer(sp.polygons(lbr_0, col = \"black\"))\n\n\nr05_10 <- (gpw42010-gpw42005)/(gpw42005)\nr05_10m <- levelplot(r05_10, col.regions=heat.colors(20), main = \"Lbr Growth Rate 2005-2010\") + layer(sp.polygons(lbr_0, col = \"black\"))\n\n\nr10_15 <- (gpw42015-gpw42010)/(gpw42010)\nr10_15m <- levelplot(r10_15, col.regions=heat.colors(20), main = \"Lbr Growth Rate 2010-2015\") + layer(sp.polygons(lbr_0, col = \"black\"))\n\ncomparison_gr<-arrangeGrob(r00_15m,r00_05m,r05_10m,r10_15m, nrow = 2, ncol = 2)\nggsave(\"lbr_com_GR_00_15.png\",comparison_gr,width = 26, height = 24, dpi = 150)\n\n##County##\npiplup <- seq(0.01, 100, by = 5)\nm1 <- levelplot(gpw4test, at=piplup, col.regions=terrain.colors(20), main = \"Lbr County Lvl Scale 0.01-100 breaks of 5\") + layer(sp.polygons(lbr_1, col = \"black\"))\nm1\nturtwig <- seq(0.01, 250, by = 5)\nm2 <- levelplot(gpw4test, at = turtwig, col.regions=terrain.colors(20), main = \"Lbr County Lvl Scale 0.01-250 breaks of 5\") + layer(sp.polygons(lbr_1, col = \"black\"))\n\nchimchar <- seq(0.01, 500, by = 5)\nm3 <- levelplot(gpw4test, at = chimchar, col.regions=terrain.colors(20), main = \"Lbr County Lvl Scale 0.01-500 breaks of 5\") + layer(sp.polygons(lbr_1, col = \"black\"))\n\nbulbasaur <- seq(0.01, 100, by = 10)\nm4 <- levelplot(gpw4test, at = bulbasaur, col.regions=terrain.colors(20), main = \"Lbr County Lvl Scale 0.01-100 breaks of 10\") + layer(sp.polygons(lbr_1, col = \"black\"))\n\ncharmander <- seq(0.01, 250, by = 10)\nm5 <- levelplot(gpw4test, at = charmander, col.regions=terrain.colors(20), main = \"Lbr County Lvl Scale 0.01-250 breaks of 10\") + layer(sp.polygons(lbr_1, col = \"black\"))\n\nsquirtle <- seq(0.01, 500, by = 10)\nm6 <- levelplot(gpw4test, at = squirtle, col.regions=terrain.colors(20), main = \"Lbr County Lvl Scale 0.01-500 breaks of 10\") + layer(sp.polygons(lbr_1, col = \"gray80\"))\n\ncomparison<-arrangeGrob(m1,m4,m2,m5,m3,m6,nrow=3,ncol=2)\nggsave(\"lbr_com_shp_cntyv2.png\",comparison,width = 22, height = 20, dpi = 150)\n\n##Districts##\npiplup <- seq(.01, 100, by = 5)\nm7 <- levelplot(gpw4test, at=piplup, col.regions=terrain.colors(20), main = \"Lbr District Lvl Scale 0.01-100 breaks of 5\") + layer(sp.polygons(lbr_2, col = \"black\"))\n\nturtwig <- seq(0.01, 250, by = 5)\nm8 <- levelplot(gpw4test, at = turtwig, col.regions=terrain.colors(20), main = \"Lbr District Lvl Scale 0.01-250 breaks of 5\") + layer(sp.polygons(lbr_2, col = \"black\"))\n\nchimchar <- seq(0.01, 500, by = 5)\nm9 <- levelplot(gpw4test, at = chimchar, col.regions=terrain.colors(20), main = \"Lbr District Lvl Scale 0.01-500 breaks of 5\") + layer(sp.polygons(lbr_2, col = \"black\"))\n\nbulbasaur <- seq(0.01, 100, by = 10)\nm10 <- levelplot(gpw4test, at = bulbasaur, col.regions=terrain.colors(20), main = \"Lbr District Lvl Scale 0.01-100 breaks of 10\") + layer(sp.polygons(lbr_2, col = \"black\"))\n\ncharmander <- seq(0.01, 250, by = 10)\nm11 <- levelplot(gpw4test, at = charmander, col.regions=terrain.colors(20), main = \"Lbr District Lvl Scale 0.01-250 breaks of 10\") + layer(sp.polygons(lbr_2, col = \"black\"))\n\nsquirtle <- seq(0.01, 500, by = 10)\nm12 <- levelplot(gpw4test, at = squirtle, col.regions=terrain.colors(20), main = \"Lbr District Lvl Scale 0.01-500 breaks of 10\") + layer(sp.polygons(lbr_2, col = \"black\"))\n\ncomparison<-arrangeGrob(m7,m10,m11,m5,m9,m12,nrow=3,ncol=2)\nggsave(\"lbr_com_shp_dist.png\",comparison,width = 22, height = 20, dpi = 150)\n\n##Clan##\npiplup <- seq(.01, 100, by = 5)\nm13 <- levelplot(gpw4test, at=piplup, col.regions=terrain.colors(20), main = \"Lbr Clan Lvl Scale 0.01-100 breaks of 5\") + layer(sp.polygons(lbr_3))\n\nturtwig <- seq(0.01, 250, by = 5)\nm14 <- levelplot(gpw4test, at = turtwig, col.regions=terrain.colors(20), main = \"Lbr Clan Lvl Scale 0.01-250 breaks of 5\") + layer(sp.polygons(lbr_3, col = \"black\"))\n\nchimchar <- seq(0.01, 500, by = 5)\nm15 <- levelplot(gpw4test, at = chimchar, col.regions=terrain.colors(20), main = \"Lbr Clan Lvl Scale 0.01-500 breaks of 5\") + layer(sp.polygons(lbr_3, col = \"black\"))\n\nbulbasaur <- seq(0.01, 100, by = 10)\nm16 <- levelplot(gpw4test, at = bulbasaur, col.regions=terrain.colors(20), main = \"Lbr Clan Lvl Scale 0.01-100 breaks of 10\") + layer(sp.polygons(lbr_3, col = \"black\"))\n\ncharmander <- seq(0.01, 250, by = 10)\nm17 <- levelplot(gpw4test, at = charmander, col.regions=terrain.colors(20), main = \"Lbr Clan Lvl Scale 0.01-250 breaks of 10\") + layer(sp.polygons(lbr_3, col = \"black\"))\n\nsquirtle <- seq(0.01, 500, by = 10)\nm18 <- levelplot(gpw4test, at = squirtle, col.regions=terrain.colors(20), main = \"Lbr Clan Lvl Scale 0.01-500 breaks of 10\") + layer(sp.polygons(lbr_3, col = \"black\"))\n\ncomparison<-arrangeGrob(m13,m16,m14,m17,m15,m18,nrow=3,ncol=2)\nggsave(\"lbr_com_shp_clan.png\",comparison,width = 22, height = 20, dpi = 150)\n##\n\n#### 3D Visualization Testing ####      \n\n## Plot3D in rgl package with RasterVis and Raster ##\ngpw4test1 <- crop(gpw4, extent(-11.55, -7.3, 4.2, 8.6)) #xmin, xmax, ymin, ymax \ngpw4test1 <- crop(gpw4, extent(country)) #xmin, xmax, ymin, ymax\ngpw4test2 <- crop(gpw4, extent (-11.55, -7.3, 4.2, 8.6))\n\nplot3D(gpw4test2, useLegend = T, at = piplup, col = terrain.colors(20))\n\n\npikachu <- seq(0.01, 1000, by = 5)\n\n\ngpw4test3 <- crop(gpw4, extent (-9,-6.5,6,8))\nplot3D(gpw4test3, useLegend = T, at = pikachu, col = terrain.colors(20))\n\ngpw4test4 <- crop(gpw4, extent (-9,-8.9,6,6.5))\nplot3D(gpw4test4, useLegend = T, at = pikachu, col = terrain.colors(20))\n\n##Plotly testing: Needs to be in the form of numbers/dataframe and not a raster so plotly will not work at the moment \np <- plot_ly(\n  x = rnorm( 1000 ), y = rnorm( 1000 ),\n  mode = 'markers' )\np\n\nt<-plot_ly(type='scattergeo', lon=c(42, 39), lat=c(12,22), text=c('Lbr'), mode='markers')\nt\n\nplot_geo()\n\nt1 <- load(\"gpw4_lbr_spdf.RData\")\n\n###Plan 3: 3D plots of 2000, 2005, 2010, and 2015 data. Compare, then find an area that experienced growth then zoom in and replot the same years\ncountry <- readOGR(dsn=\"shapefiles\", layer=\"liberia_revised\", stringsAsFactors=FALSE, verbose=FALSE)\ncounties <- readOGR(dsn=\"shapefiles\", layer=\"counties\", stringsAsFactors=FALSE, verbose=FALSE)\n\ncountry <- spTransform(country, CRS(\"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0\"))\ncounties <- spTransform(counties, CRS(\"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0\"))\n\ngpw42000<-raster(\"gpw-v4-population-count_2000.tif\")\ngpw42005<-raster(\"gpw-v4-population-count_2005.tif\")\ngpw42010<-raster(\"gpw-v4-population-count_2010.tif\")\ngpw42015<-raster(\"gpw-v4-population-count_2015.tif\")\npiplup <- seq(0.01, 100, by = 5)\n\n#Tip: Ploting all of these at once overlays them on top of each other a bit from the original plot: Don't do that\nm2000D<- plot3D(gpw42000, at = piplup, adjust=T, col=terrain.colors(20))\nm2005D<- plot3D(gpw42005, at = piplup, adjust=T, col=terrain.colors(20))\nm2010D<- plot3D(gpw42010, at = piplup, adjust=T, col=terrain.colors(20))\nm2015D<- plot3D(gpw42015, at = piplup, adjust=T, col=terrain.colors(20)) \n\n#Plan 3a Plot a small section\ngpw2000c <- crop(gpw42000, extent(-9.9, -9.3, 6.5, 7.4))\ngpw2005c <- crop(gpw42005, extent(-9.9, -9.3, 6.5, 7.4))\ngpw2010c <- crop(gpw42010, extent(-9.9, -9.3, 6.5, 7.4))\ngpw2015c <- crop(gpw42015, extent(-9.9, -9.3, 6.5, 7.4))\n\n\n#Just showing the three 2000,2005,2010 plots there is a slight increase in elevation as the years\n#go up. Also note the color change in the plateau gets a stratified appearence as time goes on\nplot3D(gpw2000c, at=dr, col=terrain.colors)\nplot3D(gpw2005c, col=terrain.colors)\nplot3D(gpw2010c, col=terrain.colors)\nplot3D(gpw2015c, col=terrain.colors)\ndr <- seq(1,100, by =1 )\n#Plant 3b plot where is a river based on lat long coordinates and observe 3D map\ngpw2000river <- crop(gpw42000, extent(-10, -9.8, 7, 8))\nplot3D(gpw2000river, col=terrain.colors(20))\n\n#Coordinated above shoudl show that individuals are not living on the intersection\n#of St. Paul River on the border of Gbarpolu and Bong, over the 3D map serves to show\n#no change in population based on the natural barrier. Thus, 3Dplot mapping may not be\n#suitible to tell where people may not live due to not account for geographic barriers\n\ncirc <- drawPoly(sp=T, col='red', lwd = 2)\n\nm2010D<- plot3D(gpw42010, at = piplup, adjust=T, col=terrain.colors(20))\n\n\nx <- c(-11,-11,-10,-10)\ny <- c(5,6,6,5)\nz <- C(10,10,10,10)\nm2010E <- plot3D(gpw42010, at = piplup, adjust=T, col=terrain.colors(20)) + layer(polygon3d(x, y, z, col = 'red'))\npolygon3d(x, y, z=rep(120, 4), col = 'blue')\npolygon3d(x, y, z=rep(140, 4), col = 'black')\n##\n\n\n#### MAPS 06/07/17 ####\ncountry <- readOGR(dsn=\"shapefiles\", layer=\"liberia_revised\", stringsAsFactors=FALSE, verbose=FALSE)\ncounties <- readOGR(dsn=\"shapefiles\", layer=\"counties\", stringsAsFactors=FALSE, verbose=FALSE)\n\ncountry <- spTransform(country, CRS(\"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0\"))\ncounties <- spTransform(counties, CRS(\"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0\"))\n\ngpw42000<-raster(\"gpw-v4-population-count_2000.tif\")\ngpw42005<-raster(\"gpw-v4-population-count_2005.tif\")\ngpw42010<-raster(\"gpw-v4-population-count_2010.tif\")\ngpw42015<-raster(\"gpw-v4-population-count_2015.tif\")\npiplup <- seq(1, 250, by = 1)\n\nblueblue<-colorRampPalette(brewer.pal(9,\"Blues\"))(250)\ngpw42010<- crop(gpw42010, extent(-10, -9, 7, 8))\nm2010 <- levelplot(gpw42010,at=piplup, main = \"2010\", col.regions=blueblue) + layer(sp.polygons(lbr_1, col = \"black\"))\nm2010\n##\n",
    "created" : 1496780373312.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "68|25|162|2|\n163|14|285|0|\n286|21|793|0|\n794|21|861|0|\n862|35|971|0|\n972|30|1059|0|\n1060|19|1078|0|\n",
    "hash" : "1639312752",
    "id" : "D5798005",
    "lastKnownWriteTime" : 1496870778,
    "last_content_update" : 1496870778910,
    "path" : "~/GitHub/Liberia/script_2.R",
    "project_path" : "script_2.R",
    "properties" : {
    },
    "relative_order" : 6,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}